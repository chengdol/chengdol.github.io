<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="中文|English">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Introduction Go users: https://github.com/golang/go/wiki/GoUsers web services, devops: docker + k8s Visual Studio Code go-plugin, vim go-plugin Install and set up a runnable demo project, a brief guid">
<meta name="keywords" content="go">
<meta property="og:type" content="article">
<meta property="og:title" content="Golang Quick Start">
<meta property="og:url" content="http://yoursite.com/2020/08/22/golang-learn/index.html">
<meta property="og:site_name" content="海胆阶段&#39;s Blog">
<meta property="og:description" content="Introduction Go users: https://github.com/golang/go/wiki/GoUsers web services, devops: docker + k8s Visual Studio Code go-plugin, vim go-plugin Install and set up a runnable demo project, a brief guid">
<meta property="og:locale" content="中文|English">
<meta property="og:updated_time" content="2023-05-06T23:26:29.449Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Golang Quick Start">
<meta name="twitter:description" content="Introduction Go users: https://github.com/golang/go/wiki/GoUsers web services, devops: docker + k8s Visual Studio Code go-plugin, vim go-plugin Install and set up a runnable demo project, a brief guid">






  <link rel="canonical" href="http://yoursite.com/2020/08/22/golang-learn/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Golang Quick Start | 海胆阶段's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="中文|English">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">海胆阶段's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">160</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">49</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">299</span></a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/22/golang-learn/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="海胆阶段">
      <meta itemprop="description" content="骐骥一跃，不能十步；驽马十驾，功在不舍">
      <meta itemprop="image" content="/images/cuishao.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海胆阶段's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Golang Quick Start

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2020-08-22 11:51:04" itemprop="dateCreated datePublished" datetime="2020-08-22T11:51:04-07:00">2020-08-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2023-05-06 16:26:29" itemprop="dateModified" datetime="2023-05-06T16:26:29-07:00">2023-05-06</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Go/" itemprop="url" rel="index"><span itemprop="name">Go</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1>Introduction</h1>
<p>Go users: <a href="https://github.com/golang/go/wiki/GoUsers" target="_blank" rel="noopener">https://github.com/golang/go/wiki/GoUsers</a>
web services, devops: docker + k8s</p>
<p>Visual Studio Code go-plugin, vim go-plugin</p>
<p>Install and set up a runnable demo project, a brief guidance can see here:
<a href="https://go.dev/doc/tutorial/getting-started" target="_blank" rel="noopener">Official Setup Go project</a></p>
<p>If forget, read through the tutorials one by one:
<a href="https://go.dev/doc/" target="_blank" rel="noopener">https://go.dev/doc/</a></p>
<p>Other resources:</p>
<ul>
<li>
<p>The Go programming Language</p>
</li>
<li>
<p><a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener">Effective Go</a> 这个更深入了，特别是用法方面</p>
</li>
<li>
<p><a href="https://blog.golang.org/index" target="_blank" rel="noopener">Go Blog</a></p>
</li>
<li>
<p><a href="https://gobyexample.com/" target="_blank" rel="noopener">Go by Example</a></p>
</li>
<li>
<p><a href="https://yourbasic.org/" target="_blank" rel="noopener">Other people web site</a></p>
</li>
<li>
<p><a href="https://studygolang.com/" target="_blank" rel="noopener">Go语言中文网</a></p>
</li>
</ul>
<p>What are go package and module is explained here:
<a href="https://go.dev/doc/code" target="_blank" rel="noopener">https://go.dev/doc/code</a>
A <code>package</code> is a collection of source files in the same directory that are
compiled together. Functions, types, variables, and constants defined in one
source file are visible to all other source files within the same package.</p>
<p>A repository contains one or more modules. A <code>module</code> is a collection of related
Go packages that are released together. A Go repository typically contains only
one module, located at the root of the repository. A file named go.mod there
declares the module path: the import path prefix for all packages within the
module. The module contains the packages in the directory containing its go.mod
file as well as subdirectories of that directory, up to the next subdirectory
containing another go.mod file (if any).</p>
<p>An <code>import path</code> is a string used to import a package. A package’s import path
is its module path joined with its subdirectory within the module. For example,
the module <a href="http://github.com/google/go-cmp" target="_blank" rel="noopener">github.com/google/go-cmp</a> contains a package in the directory cmp/.
That package’s import path is <a href="http://github.com/google/go-cmp/cmp" target="_blank" rel="noopener">github.com/google/go-cmp/cmp</a>. Packages in the
standard library do not have a module path prefix.</p>
<p>Example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A module is a collection of related Go packages that are released together</span></span><br><span class="line"><span class="comment">// in the first line of go.mod, you can see the module name</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// main package and func is the entrypoint of app</span></span><br><span class="line"><span class="comment">// the file name can be others not necessary as main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  . <span class="string">"fmt"</span> <span class="comment">// call fmt funcs directly withou fmt prefix</span></span><br><span class="line">  err <span class="string">"errors"</span> <span class="comment">// alias</span></span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">  <span class="string">"net/http"</span></span><br><span class="line">  <span class="string">"regexp"</span></span><br><span class="line">  <span class="string">"builtin"</span> <span class="comment">// no need to import</span></span><br><span class="line">  _ <span class="string">"github.com/ziutek/mysql"</span> <span class="comment">// call init in the package</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// auto append `;`, so let &#123; at the same line</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"Hello world"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>package</code> name in go file should be the same as folder name.</p>
<p>Important env variables:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## https://maelvls.dev/go111module-everywhere/</span></span><br><span class="line"><span class="comment">## In 1.15, it's equivalent to auto. </span></span><br><span class="line"><span class="comment">## In &gt;= 1.16, it's equivalent to on</span></span><br><span class="line">GO111MODULE=<span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## you can export or use `go env -w`</span></span><br><span class="line"><span class="comment">## GOROOT is set automatically</span></span><br><span class="line"><span class="built_in">export</span> GOROOT=/usr/<span class="built_in">local</span>/go</span><br><span class="line"><span class="built_in">export</span> GOBIN=<span class="variable">$GOROOT</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">## only need to set GOPATH</span></span><br><span class="line"><span class="comment">## go path is the project workspace</span></span><br><span class="line"><span class="comment">## it has src (user create), pkg and bin (auto create for you when build or install)</span></span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="variable">$HOME</span>/go</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$GOBIN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## persistent set and unset</span></span><br><span class="line">go env -w GOPATH=<span class="variable">$HOME</span>/go</span><br><span class="line">go env GOPATH</span><br><span class="line">go env -u GOPATH</span><br></pre></td></tr></table></figure>
<p>Understand <code>run</code>, <code>build</code>, <code>install</code>, <code>get</code> subcommands. pluralsight has <code>Go CLI playbook</code> course.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">go version</span><br><span class="line"></span><br><span class="line"><span class="comment">## used GO &gt;= 1.16</span></span><br><span class="line"><span class="comment">## has version suffix</span></span><br><span class="line"><span class="comment">## install binary without changing go.mod</span></span><br><span class="line">go install sigs.k8s.io/kind@v0.9.0</span><br><span class="line">go install sigs.k8s.io/kind@latest</span><br><span class="line"></span><br><span class="line"><span class="comment">## create a module</span></span><br><span class="line"><span class="comment">## link with your code repo url</span></span><br><span class="line"><span class="comment">## generate go.mod</span></span><br><span class="line">go mod init example.com/example</span><br><span class="line"><span class="comment">## add missing and remove unused modules</span></span><br><span class="line"><span class="comment">## can edit the package version in require block</span></span><br><span class="line">go mod tidy</span><br><span class="line"></span><br><span class="line"><span class="comment"># clean mod cache</span></span><br><span class="line">go clean --modcache</span><br><span class="line"></span><br><span class="line"><span class="comment">## link dependency to local path</span></span><br><span class="line"><span class="comment">## ../greetings is a local package in relative path</span></span><br><span class="line"><span class="comment">## example.com/greetings is that packages module path</span></span><br><span class="line"><span class="comment">## see this tutorial:</span></span><br><span class="line"><span class="comment">## https://go.dev/doc/tutorial/call-module-code</span></span><br><span class="line">go mod edit -replace example.com/greetings=../greetings</span><br><span class="line">go mod tidy</span><br><span class="line"></span><br><span class="line"><span class="comment"># download dependencies for off-line go build</span></span><br><span class="line"><span class="comment"># see this ticket:</span></span><br><span class="line"><span class="comment"># https://stackoverflow.com/questions/68544611/what-is-the-purpose-of-go-mod-vendor-command</span></span><br><span class="line">go mod vendor</span><br><span class="line"></span><br><span class="line"><span class="comment">## GO &gt;=1.16, only for editing go.mod</span></span><br><span class="line"><span class="comment">## -x: verbose</span></span><br><span class="line"><span class="comment">## it will modify the go.mod</span></span><br><span class="line"><span class="comment">## or you edit go.mod manually</span></span><br><span class="line">go get github.com/sirupsen/logrus@v1.8.0</span><br><span class="line"></span><br><span class="line"><span class="comment">## simliar to python dir()/help()</span></span><br><span class="line"><span class="comment">## case-insensitive</span></span><br><span class="line">go doc fmt</span><br><span class="line">go doc net/http</span><br><span class="line">go doc time.Since</span><br><span class="line">go doc fmt.Println</span><br><span class="line"><span class="comment">## local API server , browser your own package</span></span><br><span class="line">godoc -http :8080</span><br><span class="line"></span><br><span class="line"><span class="comment">## linter, but VSC will auto does that when save go files</span></span><br><span class="line">go fmt &lt;package&gt;<span class="comment"># it runs gofmt -l -w</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## test</span></span><br><span class="line"><span class="comment">## file with _test.go suffix</span></span><br><span class="line">go <span class="built_in">test</span> [-v] [-run=<span class="string">"Hello|Bye"</span>] [-cover|-coverprofile]</span><br><span class="line"></span><br><span class="line"><span class="comment">## -n: dry run</span></span><br><span class="line">go run -n main.go</span><br><span class="line"><span class="comment">## -work: print $WORK temp folder</span></span><br><span class="line"><span class="comment">## you will see the intermediary files created</span></span><br><span class="line">go run -work main.go</span><br><span class="line"><span class="comment">## run main package</span></span><br><span class="line">go run main.go</span><br><span class="line">go run .</span><br><span class="line">go run</span><br><span class="line"></span><br><span class="line"><span class="comment">## build(compile) not install</span></span><br><span class="line">go build hello</span><br><span class="line"><span class="comment">## it will create executable in bin folder</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/bin</span><br><span class="line"><span class="comment">## executable name is the same as folder name</span></span><br><span class="line">./hello</span><br><span class="line"></span><br><span class="line"><span class="comment">## install dir is control by</span></span><br><span class="line"><span class="comment">## env GOPATH and GOBIN</span></span><br><span class="line">go install hello</span><br><span class="line"></span><br><span class="line"><span class="comment"># check doc from CLI</span></span><br><span class="line">go doc rand.Float64</span><br><span class="line">go doc math.Sin</span><br><span class="line">go doc strconv.Atoi</span><br></pre></td></tr></table></figure>
<h2 id="数据类型">数据类型</h2>
<p>基本数据类型:
int32, float64, bool, string(没有char type)
复合数据类型:
array, slice, map, function, pointer, struct, interface</p>
<p>&amp;(取地址符，没有地址的算数运算), *t</p>
<h2 id="变量赋值方式">变量赋值方式</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xx = <span class="number">23</span></span><br><span class="line"><span class="keyword">var</span> xx <span class="keyword">int</span> = <span class="number">23</span> </span><br><span class="line"><span class="keyword">var</span> xx <span class="keyword">float32</span> = <span class="number">2.32</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// var block</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">  xx <span class="keyword">int</span> = <span class="number">34</span></span><br><span class="line">  yy = <span class="number">78.99</span></span><br><span class="line">  zz = <span class="string">"123"</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// 简短写法</span></span><br><span class="line">a := <span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// swap</span></span><br><span class="line">b := <span class="string">"world"</span></span><br><span class="line">a, b = b, a</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局变量不支持简短写法</span></span><br><span class="line"><span class="keyword">var</span> GLOBAL <span class="keyword">int</span> = <span class="number">100</span></span><br></pre></td></tr></table></figure>
<h2 id="常量使用">常量使用</h2>
<p>Use all upper cases</p>
<h2 id="字符串类型">字符串类型</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str1 := <span class="string">"abc"</span></span><br><span class="line">str2 := <span class="string">`abc`</span></span><br></pre></td></tr></table></figure>
<h2 id="强制类型转换">强制类型转换</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>()</span><br></pre></td></tr></table></figure>
<h2 id="算数运算符">算数运算符</h2>
<h2 id="关系运算符">关系运算符</h2>
<p>&lt;, &gt;, &lt;=, &gt;=, ==, !=</p>
<h2 id="逻辑运算符">逻辑运算符</h2>
<p>&amp;&amp;, ||, !</p>
<h2 id="位运算符">位运算符</h2>
<p>&amp;, | , ^, &amp;^(位清空), &lt;&lt;, &gt;&gt;</p>
<h2 id="If-else">If-else</h2>
<p>condition 没有括号, no ternary</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// if 还可以有初值，和for loop类似了</span></span><br><span class="line"><span class="comment">// 也可以把初值写到外面</span></span><br><span class="line"><span class="keyword">if</span> err := file.Chmod(<span class="number">0664</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Print(err)</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Switch">Switch</h2>
<p>每个case 自带break。
关键字 <code>fallthrough</code> 只能放case最后一行, 连接执行2个case且一定执行。
case 后的数据类型必须和switch一致, case 可无序，多个condition可用逗号分开。
switch 省略条件相当于<code>switch true</code>(tagless switch), 也可省略后，把condition 写在case 后面，就像if-else if了
也可以有初值<code>switch t = 100 {..}</code>, <code>t</code> only use in switch block</p>
<h2 id="For-loop">For loop</h2>
<p>no while loop
语法和C一样: <code>for init; conditionl; post {}</code>
condition no bracket</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> ;; &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> key, value := <span class="keyword">range</span> <span class="keyword">map</span> &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> index, value := <span class="keyword">range</span> [slice, array, <span class="keyword">string</span>] &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Goto">Goto</h2>
<p>前后跳都可以</p>
<h2 id="Array">Array</h2>
<p>没赋值的默认值和C语言一样:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a [<span class="number">10</span>]<span class="keyword">int</span> <span class="comment">// element default is 0</span></span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">10</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> a = [<span class="number">3</span>]<span class="keyword">float64</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">a := [<span class="number">3</span>]<span class="keyword">float64</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="comment">// 可以设置index对应的值</span></span><br><span class="line">a := [<span class="number">3</span>]<span class="keyword">float64</span> &#123;<span class="number">0</span>:<span class="number">32</span>, <span class="number">2</span>:<span class="number">99</span>&#125;</span><br><span class="line">a := [...]<span class="keyword">float64</span> &#123;<span class="number">0</span>:<span class="number">32</span>, <span class="number">2</span>:<span class="number">99</span>&#125;</span><br><span class="line"><span class="built_in">len</span>(a)</span><br><span class="line"><span class="built_in">cap</span>(a)</span><br><span class="line"><span class="comment">// ascending sort </span></span><br><span class="line">sort.Ints(a)</span><br></pre></td></tr></table></figure>
<p>对于数组 len(a) 长度= cap(a) 容量</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// same address usage as C language</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>]<span class="keyword">int32</span>&#123;<span class="number">99</span>, <span class="number">100</span>, <span class="number">101</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组是值传递, 改变arr2中的值不会改变arr, 函数中注意, 除非传递的是地址</span></span><br><span class="line"><span class="comment">// 可直接复制</span></span><br><span class="line">arr2 := arr</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">fmt.Println(arr2 == arr)</span><br><span class="line"><span class="comment">// type [3]int</span></span><br><span class="line">fmt.Printf(<span class="string">"%T\n"</span>, arr2)</span><br><span class="line"><span class="comment">// 注意在go中数组名不是地址了，要专门用取地址符号</span></span><br><span class="line"><span class="comment">// 这2个值一样的</span></span><br><span class="line">fmt.Printf(<span class="string">"%p\n"</span>, &amp;arr)</span><br><span class="line">fmt.Printf(<span class="string">"%p\n"</span>, &amp;arr[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">// t1 其实是指针类型 *[3]int32</span></span><br><span class="line">t1 := &amp;arr</span><br><span class="line">fmt.Printf(<span class="string">"%d\n"</span>, (*t1)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>二维数组</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr := [<span class="number">3</span>][<span class="number">3</span>]<span class="keyword">int</span>&#123;&#123;&#125;,&#123;&#125;,&#123;&#125;&#125;</span><br><span class="line"><span class="built_in">len</span>(arr)</span><br><span class="line"><span class="built_in">len</span>(arr[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<h2 id="Slice">Slice</h2>
<p>动态数组，大小可变，背后有一个底层数组.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不写长度, slice = nil, no underlying array</span></span><br><span class="line"><span class="comment">// have to append to use it</span></span><br><span class="line"><span class="keyword">var</span> slice1 []<span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> slice1 = []<span class="keyword">float64</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="comment">// make(type, len, capacity) len 必须小于或等于 cap</span></span><br><span class="line"><span class="comment">// make function is in builtin package</span></span><br><span class="line"><span class="comment">// used to create object</span></span><br><span class="line">slice1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">2</span>) <span class="comment">// len, cap = 2</span></span><br><span class="line">slice1 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="number">2</span>) <span class="comment">// len = 0, cap = 2</span></span><br><span class="line"><span class="comment">// slice1中存的就是切片的地址，不需要取地址符了</span></span><br><span class="line"><span class="comment">// 而数组的地址则是&amp;arr</span></span><br><span class="line">fmt.Printf(<span class="string">"%p\n"</span>, slice1)</span><br><span class="line"></span><br><span class="line">slice1 = <span class="built_in">append</span>(slice1, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>)</span><br><span class="line">slice2 := []<span class="keyword">int</span>&#123;<span class="number">10</span>, <span class="number">11</span>&#125;</span><br><span class="line"><span class="comment">// 注意这里用...，类似于python的分解操作，如果查看append的定义，其实它的末尾参数是个可变参数...type</span></span><br><span class="line"><span class="comment">// 当append超过容量后，生成新的切片的，地址就变了</span></span><br><span class="line"><span class="comment">// 自动扩容是之前的2倍</span></span><br><span class="line">slice1 = <span class="built_in">append</span>(slice1, slice2...)</span><br><span class="line"></span><br><span class="line"><span class="comment">// map, slice 是地址传递!</span></span><br><span class="line"><span class="comment">// 指向同一个地址</span></span><br><span class="line">slice3 := slice1</span><br><span class="line"></span><br><span class="line"><span class="comment">// create slice from array</span></span><br><span class="line"><span class="comment">// slice1和arr1指向同一个地址，共享数据，除非slice1扩容则会新生成一个内存地址</span></span><br><span class="line">arr1 := [<span class="number">10</span>]<span class="keyword">int</span></span><br><span class="line"><span class="comment">// [start, end)</span></span><br><span class="line">slice1 := arr1[:]</span><br><span class="line">slice1 := arr1[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line">slice1 := arr1[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line"><span class="comment">// 这时候slice1地址和arr1不一样了</span></span><br><span class="line">slice1 = <span class="built_in">append</span>(slice1, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// deep copy, for []type</span></span><br><span class="line"><span class="built_in">copy</span>(dst, src)</span><br><span class="line"><span class="built_in">copy</span>(slice2[<span class="number">2</span>:], slice[<span class="number">1</span>:])</span><br></pre></td></tr></table></figure>
<h2 id="Map">Map</h2>
<p>To understand map, see this question and the comment:
<a href="https://stackoverflow.com/questions/40680981/are-maps-passed-by-value-or-by-reference-in-go" target="_blank" rel="noopener">https://stackoverflow.com/questions/40680981/are-maps-passed-by-value-or-by-reference-in-go</a>
this is a go <a href="https://go.dev/play/p/Q6vrAmmJWR6" target="_blank" rel="noopener">playground</a> for map to help understand its behavior:</p>
<p>If a map isn’t a reference variable, <a href="https://dave.cheney.net/2017/04/30/if-a-map-isnt-a-reference-variable-what-is-it" target="_blank" rel="noopener">what is it</a>?</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nil map, 不能直接用</span></span><br><span class="line"><span class="keyword">var</span> map1 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">float64</span></span><br><span class="line">fmt.Println(map1 == <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">map1 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>)</span><br><span class="line">map1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">map1 := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;<span class="string">"hello"</span>: <span class="number">100</span>, <span class="string">"Java"</span>: <span class="number">99</span>&#125;</span><br><span class="line"></span><br><span class="line">map1[<span class="string">"see"</span>] = <span class="number">-34</span></span><br><span class="line">val1 := map1[<span class="string">"hello"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果map没有key，取出来的是value类型的"0"值</span></span><br><span class="line"><span class="comment">// 怎么判断呢? ok is bool, if true, then exist</span></span><br><span class="line">val, ok := <span class="keyword">map</span>[<span class="string">"key"</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">delete</span>(map1[<span class="string">"see"</span>])</span><br><span class="line"><span class="built_in">len</span>(map1)</span><br></pre></td></tr></table></figure>
<h2 id="String">String</h2>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UTF-8 coding</span></span><br><span class="line">str := <span class="string">"hello"</span></span><br><span class="line">str := <span class="string">`hello`</span></span><br><span class="line"><span class="comment">// string is acutally byte sequence</span></span><br><span class="line">slice := []<span class="keyword">byte</span>&#123;<span class="number">65</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">68</span>&#125;</span><br><span class="line">str1 := <span class="keyword">string</span>(slice1)</span><br><span class="line">slice := []<span class="keyword">byte</span>(str1)</span><br><span class="line"></span><br><span class="line">substr := str[<span class="number">1</span>:<span class="number">3</span>]</span><br><span class="line"><span class="comment">// strings package 主要是字符串 操作函数</span></span><br><span class="line"><span class="comment">// strconv package 主要是字符串 和 基本数据类型之间相互转换</span></span><br><span class="line"><span class="comment">// go '+' operands must have same type, so use Sprintf to concat</span></span><br><span class="line"><span class="comment">// different type</span></span><br><span class="line"><span class="string">"123"</span> + strconv.Itoa(<span class="number">100</span>)</span><br><span class="line">b1, err := strconv.ParseBool(<span class="string">"true"</span>)</span><br><span class="line">str1 := strconv.FormatBool(b1)</span><br></pre></td></tr></table></figure>
<h2 id="defer">defer</h2>
<p>用于延迟函数或方法的执行, 用<code>defer</code> 控制的调用会等到它的containing/surrounding function执行完了之后再执行，并且当所有延迟的部分执行结束之后，containing function才执行return 语句。</p>
<p>如果有多个<code>defer</code>,则按照后进先出的顺序。
用法：</p>
<ul>
<li>关闭连接，文件，比如defer close() 在函数的开头.</li>
<li>panic, recover，defer函数执行完毕后，异常才会被抛出到上一层.</li>
</ul>
<p>注意，延迟函数的arguments的值，在<code>defer</code>的时候就固定了，值也可能是地址，则复合对象的内部值可能被改变了。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deferTest</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">defer</span> fmt.Println(<span class="string">"1"</span>)</span><br><span class="line">  <span class="keyword">defer</span> fmt.Println(<span class="string">"2"</span>)</span><br><span class="line">  fmt.Println(<span class="string">"3"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>Function</h1>
<p>函数也是一种复合数据类型，可以用<code>%T</code> 查看。
注意函数的参数类型和参数名是反过来写的，且返回值类型列表也写在最后。
函数名如果大写开头 表示公共函数，可被其他package调用，比如fmt.Println()，否则只能package内部访问。
参数传递没有python这么多形式。</p>
<p>参数传递也有值传递和引用(地址)传递.
值传递: int, float, string, bool, array, struct
引用传递: slice, map, chan</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// (int, int) 对应了 return val1, val2的类型</span></span><br><span class="line"><span class="comment">// 注意这里p2是slice, p3是array</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">(p1 <span class="keyword">int</span>, p2 []float, p3 [10]<span class="keyword">int</span>, p4 <span class="keyword">map</span>)</span> <span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="comment">// logic</span></span><br><span class="line">  <span class="keyword">return</span> val1, val2</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 或者只写return，返回列表里已经有了返回值名字了</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">(p1 <span class="keyword">int</span>, p2 []float)</span> <span class="params">(val1 <span class="keyword">int</span>, val2 <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  val1 = p1 * <span class="number">3</span></span><br><span class="line">  val2 = <span class="built_in">len</span>(p2)</span><br><span class="line">  <span class="comment">// return named values</span></span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 或者return 单纯用来结束函数</span></span><br><span class="line"><span class="comment">// 注意这里没有定义返回值列表</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果只有一个返回值，可以不写括号</span></span><br><span class="line"><span class="comment">// 多个参数类型一致，可以把类型写在后边一起</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">(p1, p2 <span class="keyword">int</span>, p3 <span class="keyword">string</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> val1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可变参数<code>...</code>，只能放到参数列表的最后，且只能有一个可变参数:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...type，0个到多个参数都可以，比如Println()就是</span></span><br><span class="line"><span class="comment">// nums 是个slice类型</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">funcName</span><span class="params">(p1 <span class="keyword">int</span>, nums ...<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  <span class="comment">// pass</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用的时候注意，如果是复合类型数据需要分解</span></span><br><span class="line">funcName(<span class="number">100</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// split sign `...`</span></span><br><span class="line">funcName(<span class="number">100</span>, []<span class="keyword">int</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;...)</span><br></pre></td></tr></table></figure>
<p>可以定义函数变量，然后赋值，其实赋值的是函数的地址:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c <span class="function"><span class="keyword">func</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="title">c</span> = <span class="title">fmt</span>.<span class="title">Println</span></span></span><br></pre></td></tr></table></figure>
<p><a href="https://yourbasic.org/golang/anonymous-function-literal-lambda-closure/" target="_blank" rel="noopener">Anonymous functions and closures</a>
匿名函数，没有函数名，可以赋值给变量 或 直接调用. 所以说Go是支持函数式编程的，匿名函数可以作为其他函数的参数(这个作为参数的函数就叫回调函数)，注意不是函数执行的返回值作为参数，是函数本身! 匿名函数也可以作为返回值(闭包)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// no function name and call it</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println()</span><br><span class="line">&#125;()</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">fun3 := <span class="function"><span class="keyword">func</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println()</span><br><span class="line">&#125;</span><br><span class="line">fun3()</span><br></pre></td></tr></table></figure>
<p>回调函数:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// callback function</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// calling function</span></span><br><span class="line"><span class="comment">// here we can define func type to replace 'func(int, int)int' in argument list</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">operate</span><span class="params">(a, b <span class="keyword">int</span>, fun <span class="keyword">func</span>(<span class="keyword">int</span>, <span class="keyword">int</span>)</span><span class="title">int</span>) <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> fun(a, b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// call</span></span><br><span class="line">operate(<span class="number">1</span>, <span class="number">3</span>, add)</span><br></pre></td></tr></table></figure>
<p>闭包closure, 这里外部函数返回后，匿名函数把外部函数内部的资源<code>i</code>保留了下来。Python中local function一样的道理.
A closure is a function value that references variables from outside its body.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// `func() int` is treated as return type as a whole</span></span><br><span class="line"><span class="comment">// the increment() return a closure</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">increment</span><span class="params">()</span> <span class="title">func</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">  <span class="comment">// stay alive in closure function</span></span><br><span class="line">  i := <span class="number">0</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span> <span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    i++</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res := increment()</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line">fmt.Println(res())</span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line">fmt.Println(res())</span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line">fmt.Println(res())</span><br></pre></td></tr></table></figure>
<h1>Pointer</h1>
<p>指针类型符号<code>*</code>, 和C语言一样.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// nil is pointer's default vaule</span></span><br><span class="line"><span class="keyword">var</span> p1 *<span class="keyword">int</span></span><br><span class="line">a := <span class="number">10</span></span><br><span class="line">p1 = &amp;a</span><br><span class="line"><span class="comment">// print pointer value</span></span><br><span class="line">fmt.Println(p1)</span><br><span class="line">fmt.Printf(<span class="string">"%p\n"</span>, p1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指针的指针</span></span><br><span class="line"><span class="keyword">var</span> pp1 **<span class="keyword">int</span></span><br><span class="line">pp1 = &amp;p1</span><br></pre></td></tr></table></figure>
<p>数组指针，指向数组的指针</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">arr := [<span class="number">3</span>]<span class="keyword">int</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">var</span> pa *[<span class="number">3</span>]<span class="keyword">int</span></span><br><span class="line">pa = &amp;arr</span><br><span class="line"><span class="comment">// 这个输出注意，并不是输出的地址数值，而是一种形式</span></span><br><span class="line"><span class="comment">// 如果要输出地址数值，用%p</span></span><br><span class="line">fmt.Println(pa) <span class="comment">// &amp;[1 2 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// the address of arr</span></span><br><span class="line">fmt.Printf(<span class="string">"%p\n"</span>, pa)</span><br><span class="line">fmt.Printf(<span class="string">"%p\n"</span>, &amp;arr)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相同的表达</span></span><br><span class="line">(*pa)[<span class="number">0</span>]</span><br><span class="line">pa[<span class="number">0</span>] <span class="comment">// (*pa)[0] 的简化写法</span></span><br><span class="line">arr[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>指针数组，元素是指针的数组</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a := <span class="number">1</span></span><br><span class="line">b := <span class="number">2</span></span><br><span class="line">c := <span class="number">3</span></span><br><span class="line">arr := [<span class="number">3</span>]*<span class="keyword">int</span> &#123;&amp;a, &amp;b, &amp;c&#125;</span><br><span class="line">fmt.Println(arr)</span><br></pre></td></tr></table></figure>
<p>For example:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指向 指针数组的指针</span></span><br><span class="line">*[<span class="number">3</span>]*<span class="keyword">int</span></span><br><span class="line"><span class="comment">// 指向 数组指针的指针</span></span><br><span class="line">**[<span class="number">5</span>]<span class="keyword">string</span></span><br><span class="line"><span class="comment">// 指向 指针数组指针的指针</span></span><br><span class="line">**[<span class="number">3</span>]*<span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>函数指针，指向函数的指针, Go中函数名就是函数的地址，如同slice, map一样:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c <span class="function"><span class="keyword">func</span><span class="params">(a ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br><span class="line"><span class="function"><span class="title">c</span> = <span class="title">fmt</span>.<span class="title">Println</span></span></span><br></pre></td></tr></table></figure>
<p>指针函数，返回指针值的函数:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2个地址输出是一样的</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getArr</span><span class="params">()</span> *<span class="title">int</span>[4]</span> &#123;</span><br><span class="line">  arr := [<span class="number">3</span>]<span class="keyword">int</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">  fmt.Printf(<span class="string">"%p\n"</span>, &amp;arr)</span><br><span class="line">  <span class="keyword">return</span> &amp;arr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">arr := getArr()</span><br><span class="line">fmt.Printf(<span class="string">"%p\n"</span>, &amp;arr)</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Struct</span></span><br><span class="line"><span class="string">Usually struct has [struct tag](https://stackoverflow.com/questions/55544525/what-is-the-string-after-the-name-and-type-in-a-struct-in-golang).</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">go</span></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">  name <span class="keyword">string</span></span><br><span class="line">  age <span class="keyword">int</span></span><br><span class="line">  sex <span class="keyword">string</span></span><br><span class="line">  address <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 几种创建方式</span></span><br><span class="line"><span class="comment">// p1 is an empty struct object with default values</span></span><br><span class="line"><span class="keyword">var</span> p1 Person</span><br><span class="line"><span class="comment">// same as p1</span></span><br><span class="line"><span class="comment">// 可以拿到外面赋值， 比如p2.age = 34</span></span><br><span class="line">p2 := Person&#123;&#125;</span><br><span class="line"></span><br><span class="line">p3 := Person (name: <span class="string">"XXX"</span>, age: <span class="number">23</span>, sex: <span class="string">"female"</span>, address: <span class="string">"YYY"</span>)</span><br><span class="line">p4 := Person &#123;</span><br><span class="line">  name: <span class="string">"XXX"</span>, </span><br><span class="line">  age: <span class="number">23</span>, </span><br><span class="line">  sex: <span class="string">"female"</span>, </span><br><span class="line">  address: <span class="string">"YYY"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// order matters</span></span><br><span class="line">p3 := Person (<span class="string">"XXX"</span>, <span class="number">23</span>, <span class="string">"female"</span>, <span class="string">"YYY"</span>)</span><br></pre></td></tr></table></figure>
<p>结构体是值类型的，和array一样，结构体名不是它的地址。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是内容复制</span></span><br><span class="line">p4 := p1</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这是地址赋值</span></span><br><span class="line"><span class="keyword">var</span> pp1 *Person</span><br><span class="line">pp1 = &amp;p1</span><br><span class="line"><span class="comment">// 访问字段，以下都可以</span></span><br><span class="line">pp1.name</span><br><span class="line">(*pp1).name</span><br></pre></td></tr></table></figure>
<p><code>make</code>只能创建map, slice, channel等
<code>make</code> vs <code>new</code>: <a href="https://www.godesignpatterns.com/2014/04/new-vs-make.html" target="_blank" rel="noopener">https://www.godesignpatterns.com/2014/04/new-vs-make.html</a>
<code>new</code> returns pointer:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// they are the same</span></span><br><span class="line"><span class="keyword">var</span> p1 Person</span><br><span class="line">pp1 := &amp;p1</span><br><span class="line"></span><br><span class="line">pp1 := &amp;Persion&#123;&#125;</span><br><span class="line">pp1 := <span class="built_in">new</span>(Persion)</span><br></pre></td></tr></table></figure>
<p><code>new</code>可以创建任意类型空间 和 返回任意类型的指针:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pint := <span class="built_in">new</span>(<span class="keyword">int</span>)</span><br></pre></td></tr></table></figure>
<p>匿名结构体，和匿名函数类似的定义用法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这里定义了一个匿名结构体 同时进行赋值</span></span><br><span class="line">s2 := <span class="keyword">struct</span> &#123;</span><br><span class="line">  name <span class="keyword">string</span></span><br><span class="line">  age <span class="keyword">int</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">  name: <span class="string">"xxx"</span>,</span><br><span class="line">  age: <span class="number">18</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>匿名字段，字段没有名字，且字段类型不能重复:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Worker <span class="keyword">struct</span> &#123;</span><br><span class="line">  <span class="comment">// 只能有一个string</span></span><br><span class="line">  <span class="keyword">string</span></span><br><span class="line">  <span class="comment">// 只能有一个int</span></span><br><span class="line">  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">w1 := Worker &#123;<span class="string">"xxx"</span>, <span class="number">11</span>&#125;</span><br><span class="line"><span class="comment">// 默认使用数据类型作为访问的名字</span></span><br><span class="line">fmt.Println(w1.<span class="keyword">string</span>)</span><br><span class="line">fmt.Println(w1.<span class="keyword">int</span>)</span><br></pre></td></tr></table></figure>
<p>结构体嵌套:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">  a <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">  b <span class="keyword">string</span></span><br><span class="line">  c A</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s := B &#123;b: <span class="string">"from B"</span>, c: A &#123;a: <span class="string">"from A"</span>&#125;&#125;</span><br><span class="line"><span class="comment">// access field</span></span><br><span class="line">s.b</span><br><span class="line">s.c.a</span><br></pre></td></tr></table></figure>
<p>如果对嵌套结构体使用了匿名字段，则相当于融合到了当前结构体，访问的时候不用中间层了。这在OOP 中使用到了:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A <span class="keyword">struct</span> &#123;</span><br><span class="line">  a <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> B <span class="keyword">struct</span> &#123;</span><br><span class="line">  b <span class="keyword">string</span></span><br><span class="line">  A</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意这里匿名字段初始化A: A&#123;a: "from A"&#125;</span></span><br><span class="line">s := B&#123;b: <span class="string">"from B"</span>, A: A&#123;a: <span class="string">"from A"</span>&#125;&#125;</span><br><span class="line"><span class="comment">// access field</span></span><br><span class="line">s.b</span><br><span class="line"><span class="comment">// 中间层被省略了</span></span><br><span class="line">s.a</span><br></pre></td></tr></table></figure>
<h1>Type</h1>
<p><code>type</code> 除了定义结构体，接口，还可以定义全新的类型 或者 别名:
<a href="https://yourbasic.org/golang/function-pointer-type-declaration/" target="_blank" rel="noopener">function type and value</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// myint, mystr 就是全新的类型了 </span></span><br><span class="line"><span class="keyword">type</span> myint <span class="keyword">int</span></span><br><span class="line"><span class="keyword">type</span> mystr <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不能和原类型相互赋值！</span></span><br><span class="line"><span class="keyword">var</span> myint = <span class="number">23</span></span><br><span class="line"><span class="keyword">var</span> mystr = <span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// myint, mystr 只是一个别名，注意和上面的区别</span></span><br><span class="line"><span class="keyword">type</span> myint = <span class="keyword">int</span></span><br><span class="line"><span class="keyword">type</span> mystr = <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以和原类型相互赋值！</span></span><br><span class="line"><span class="keyword">var</span> a <span class="keyword">int</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> b myint = a</span><br></pre></td></tr></table></figure>
<p>Go语言实现函数式编程的时候，如果函数复杂，可以用<code>type</code> 简化，这里的例子是作为返回值，也可以作为参数:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 把func(string, string) string 整体别名叫做myfun</span></span><br><span class="line"><span class="keyword">type</span> myfun <span class="function"><span class="keyword">func</span><span class="params">(<span class="keyword">string</span>, <span class="keyword">string</span>)</span> <span class="title">string</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// <span class="title">myfun</span> 作为<span class="title">fun1</span> 的返回值类型，就不用写一大堆了</span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="title">fun1</span><span class="params">()</span> <span class="title">myfun</span></span> &#123;</span><br><span class="line">  <span class="comment">// 返回一个函数</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(a, b <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用, res得到一个函数定义</span></span><br><span class="line">res := fun1()</span><br><span class="line"><span class="comment">// "100100"</span></span><br><span class="line">fmt.Println(res(<span class="string">"100"</span>, <span class="string">"100"</span>))</span><br></pre></td></tr></table></figure>
<p>还需要注意的是，一个package中定义的别名，不能在其他包中为它添加method.</p>
<h1>Error</h1>
<p>Go中不要把错误 和 异常弄混了，这个还要单独看其他文章区分一下使用环境。</p>
<p>Go中错误也是一种数据类型<code>error</code>, 惯例是<code>error</code> 在函数中返回值的最后一个位置, error其实是一个接口:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> error <span class="keyword">interface</span> &#123;</span><br><span class="line">    Error() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="string">"os"</span></span><br><span class="line">  <span class="string">"log"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 很多包中的函数都会有错误信息返回，特别是文件，网络操作</span></span><br><span class="line">  f, err := os.Open(<span class="string">"./test.txt"</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">    <span class="comment">// 得到具体的错误类型，输出其他字段</span></span><br><span class="line">    <span class="comment">// *os.PathError 是这个函数返回的错误类型</span></span><br><span class="line">    <span class="keyword">if</span> ins, ok := err.(*os.PathError); ok &#123;</span><br><span class="line">      <span class="comment">// 错误中的字段</span></span><br><span class="line">      fmt.Println(ins.Op)</span><br><span class="line">      fmt.Println(ins.Path)</span><br><span class="line">      fmt.Println(ins.Err)</span><br><span class="line">      <span class="comment">// 如果错误实现了自己的方法，调用方法也行</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// pass</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自己如何创建错误呢, 通过<code>errors.New</code>这个package提供的函数 或者<code>fmt.Errorf</code>:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  <span class="string">"errors"</span></span><br><span class="line">  <span class="string">"fmt"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  err1 := errors.New(<span class="string">"my error"</span>)</span><br><span class="line">  fmt.Println(err1)</span><br><span class="line">  <span class="comment">// 是 *errors.errorString 类型</span></span><br><span class="line">  fmt.Printf(<span class="string">"%T\n"</span>, err1)</span><br><span class="line"></span><br><span class="line">  err2 := fmt.Errorf(<span class="string">"my error is %d"</span>, <span class="number">100</span>)</span><br><span class="line">  fmt.Println(err2)</span><br><span class="line">  <span class="comment">// 是 *errors.errorString 类型</span></span><br><span class="line">  fmt.Printf(<span class="string">"%T\n"</span>, err2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上只是简单的例子，复杂的error 是通过结构体实现的，里面包含了错误的具体信息，然后实现了<code>error</code> 这个接口.</p>
<h1>Panic and Recover</h1>
<p>和<code>defer</code> 一起使用较多，遇到<code>panic</code>，函数后续会停止执行，然后逆序执行所有已经遇到的当前层的<code>defer</code>函数，没遇到的不会执行，因为中断了，最后往上层抛出异常，
<code>defer</code> 函数中可能包含<code>recover</code> 来恢复<code>panic</code>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">A</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"from A"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">B</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">"from B"</span>)</span><br><span class="line">  <span class="keyword">defer</span> fmt.Println(<span class="string">"from B defer 1"</span>)</span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">10</span>; i++ &#123;</span><br><span class="line">    fmt.Println(<span class="string">"i = "</span>, i)</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">5</span> &#123;</span><br><span class="line">      <span class="comment">// panic throw</span></span><br><span class="line">      <span class="built_in">panic</span>(<span class="string">"panic happened"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// will not execute this defer</span></span><br><span class="line">  <span class="keyword">defer</span> fmt.Println(<span class="string">"from B defer 2"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// 捕捉恢复了panic</span></span><br><span class="line">  <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> msg := <span class="built_in">recover</span>(); msg != <span class="literal">nil</span> &#123;</span><br><span class="line">      fmt.Println(<span class="string">"from recover"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  A()</span><br><span class="line">  <span class="keyword">defer</span> fmt.Println(<span class="string">"from main defer 1"</span>)</span><br><span class="line">  B()</span><br><span class="line">  <span class="comment">// 这后面不会被执行了</span></span><br><span class="line">  <span class="keyword">defer</span> fmt.Println(<span class="string">"from main defer 2"</span>)</span><br><span class="line">  fmt.Println(<span class="string">"from main end"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>哪些场景适合使用panic呢?</p>
<ul>
<li>空指针</li>
<li>下标越界</li>
<li>除数为0</li>
<li>分支没有出现</li>
<li>错误输入</li>
</ul>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/go/" rel="tag"># go</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/08/14/python-scripting/" rel="next" title="Python3 Scripting">
                <i class="fa fa-chevron-left"></i> Python3 Scripting
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/08/22/python-virtual-environment/" rel="prev" title="Python Packages and Virtual Environment">
                Python Packages and Virtual Environment <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/cuishao.png" alt="海胆阶段">
            
              <p class="site-author-name" itemprop="name">海胆阶段</p>
              <p class="site-description motion-element" itemprop="description">骐骥一跃，不能十步；驽马十驾，功在不舍</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">299</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">49</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">160</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据类型"><span class="nav-number">1.1.</span> <span class="nav-text">数据类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#变量赋值方式"><span class="nav-number">1.2.</span> <span class="nav-text">变量赋值方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常量使用"><span class="nav-number">1.3.</span> <span class="nav-text">常量使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#字符串类型"><span class="nav-number">1.4.</span> <span class="nav-text">字符串类型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#强制类型转换"><span class="nav-number">1.5.</span> <span class="nav-text">强制类型转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#算数运算符"><span class="nav-number">1.6.</span> <span class="nav-text">算数运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#关系运算符"><span class="nav-number">1.7.</span> <span class="nav-text">关系运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#逻辑运算符"><span class="nav-number">1.8.</span> <span class="nav-text">逻辑运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#位运算符"><span class="nav-number">1.9.</span> <span class="nav-text">位运算符</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#If-else"><span class="nav-number">1.10.</span> <span class="nav-text">If-else</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Switch"><span class="nav-number">1.11.</span> <span class="nav-text">Switch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#For-loop"><span class="nav-number">1.12.</span> <span class="nav-text">For loop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Goto"><span class="nav-number">1.13.</span> <span class="nav-text">Goto</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Array"><span class="nav-number">1.14.</span> <span class="nav-text">Array</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Slice"><span class="nav-number">1.15.</span> <span class="nav-text">Slice</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Map"><span class="nav-number">1.16.</span> <span class="nav-text">Map</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String"><span class="nav-number">1.17.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#defer"><span class="nav-number">1.18.</span> <span class="nav-text">defer</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">Function</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">3.</span> <span class="nav-text">Pointer</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">4.</span> <span class="nav-text">Type</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">5.</span> <span class="nav-text">Error</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">6.</span> <span class="nav-text">Panic and Recover</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2024</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chengdong Liao</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.7.0</div>





  <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>

        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  

  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  











  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('Copied');
          else $(this).text('Copy failed');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('Copy');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>
