<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Good description for daily use: One time I was in the ocean and a wave crashed on top of me and took my breath away as it pulled me deeper into the ocean. Just as I started to recover my breath, anoth">
<meta name="keywords" content="book,python">
<meta property="og:type" content="article">
<meta property="og:title" content="Python for Devops">
<meta property="og:url" content="http://yoursite.com/2019/10/01/book-python-for-devops/index.html">
<meta property="og:site_name" content="海胆阶段&#39;s Blog">
<meta property="og:description" content="Good description for daily use: One time I was in the ocean and a wave crashed on top of me and took my breath away as it pulled me deeper into the ocean. Just as I started to recover my breath, anoth">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-12-29T06:51:58.692Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Python for Devops">
<meta name="twitter:description" content="Good description for daily use: One time I was in the ocean and a wave crashed on top of me and took my breath away as it pulled me deeper into the ocean. Just as I started to recover my breath, anoth">






  <link rel="canonical" href="http://yoursite.com/2019/10/01/book-python-for-devops/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Python for Devops | 海胆阶段's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">海胆阶段's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">93</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">29</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">165</span></a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/01/book-python-for-devops/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="海胆阶段">
      <meta itemprop="description" content="骐骥一跃，不能十步；驽马十驾，功在不舍">
      <meta itemprop="image" content="/images/cuishao.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海胆阶段's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Python for Devops

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-10-01 10:41:11" itemprop="dateCreated datePublished" datetime="2019-10-01T10:41:11-07:00">2019-10-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-12-28 22:51:58" itemprop="dateModified" datetime="2019-12-28T22:51:58-08:00">2019-12-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Book/" itemprop="url" rel="index"><span itemprop="name">Book</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Symbols count in article: </span>
                
                <span title="Symbols count in article">55k</span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Good description for daily use:</p>
<p>One time I was in the ocean and a wave crashed on top of me and took my breath away as it pulled me deeper into the ocean. Just as I started to recover my breath, another wave dropped on top of me and extracted much of my remaining energy and pulled me even deeper into the ocean. Just as I started to recover, yet another wave crashed down on top of me. The more I would fight the waves and the ocean, the more energy I drained. I seriously wondered if I would die at that moment. I couldn’t breath, my body ached and I was terrified I was going to drown.</p>
<p>Being close to death helped me focus on the only thing that could save me, which was conserving my energy and using the waves not fighting them.</p>
<h1 id="Install-and-Configure"><a href="#Install-and-Configure" class="headerlink" title="Install and Configure"></a>Install and Configure</h1><p>Usually python2 is pre-installed, need to install <code>python3</code>, can refer this blog<br><a href="https://www.osradar.com/install-python-3-7-on-centos-7-and-fedora-27-28/" target="_blank" rel="noopener">Install Python 3.7 on centos 7</a><br>This installation will not disturb original <code>python2</code> pre-installed (it is the dependency of some other packages).</p>
<p><a href="https://pip.pypa.io/en/stable/installing/" target="_blank" rel="noopener">install pip3</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</span><br><span class="line"><span class="comment">## install pip3</span></span><br><span class="line">python3 get-pip.py</span><br><span class="line"><span class="comment">## or install pip</span></span><br><span class="line">python get-pip.py</span><br></pre></td></tr></table></figure></p>
<p>then you can use <code>pip3</code> to install other packages, otherwise <code>pip</code> is still use <code>python2</code>.</p>
<p>Make <a href="https://askubuntu.com/questions/320996/how-to-make-python-program-command-execute-python-3" target="_blank" rel="noopener">python command execute python3</a>, you can use alias.</p>
<p><a href="https://packaging.python.org/guides/installing-using-pip-and-virtual-environments/" target="_blank" rel="noopener">Installing packages using pip and virtual environments</a></p>
<h1 id="Chapter-1-Introduction"><a href="#Chapter-1-Introduction" class="headerlink" title="Chapter 1 Introduction"></a>Chapter 1 Introduction</h1><p>Install <code>ipython</code> or <code>ipython3</code>, powerful mixed interactive shell:<br><a href="https://ipython.org/index.html#" target="_blank" rel="noopener">https://ipython.org/index.html#</a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pip install ipython</span><br><span class="line"><span class="comment">## or</span></span><br><span class="line">pip3 install ipython</span><br></pre></td></tr></table></figure></p>
<p>then run it as<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipython</span><br><span class="line"><span class="comment">## or</span></span><br><span class="line">ipython3</span><br></pre></td></tr></table></figure></p>
<p>Python variables use dynamic typing. In practice, this means reassigned to values of different types or classes</p>
<h2 id="Built-in-Functions"><a href="#Built-in-Functions" class="headerlink" title="Built-in Functions"></a>Built-in Functions</h2><ul>
<li>print</li>
<li>range<br>Use spaces instead of tabs to indent.</li>
</ul>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><p>functions can be object, can put it in the list.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>functions = [double, triple]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> function <span class="keyword">in</span> functions:</span><br><span class="line"><span class="meta">... </span>    print(function(<span class="number">3</span>))</span><br></pre></td></tr></table></figure></p>
<p>Wrapping Functions with Decorators, there are some other python command line build tools. <a href="https://click.palletsprojects.com" target="_blank" rel="noopener"><code>click</code> package</a>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install click</span><br></pre></td></tr></table></figure></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''A example of using the click package to develop a command line tool'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.argument('name')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(name)</span>:</span></span><br><span class="line">    <span class="string">'''Say hello to name'''</span>    </span><br><span class="line">    print(<span class="string">f"Hello <span class="subst">&#123;name&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    hello()</span><br></pre></td></tr></table></figure>
<p>call it:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python simple_cli.py Sue</span><br><span class="line">Hello Sue</span><br></pre></td></tr></table></figure></p>
<p>lambda function, just like <code>java</code> use lambda to create comparator for priority queue.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sorted(items, key=<span class="keyword">lambda</span> item: item[<span class="number">1</span>])</span><br></pre></td></tr></table></figure></p>
<h2 id="RE-package"><a href="#RE-package" class="headerlink" title="RE package"></a>RE package</h2><p>The <code>re</code> module uses <code>\</code> to delineate special character for matching, for example <code>\.</code>, <code>\n</code>, etc. To avoid confusion with regular string escape sequences, <code>raw</code> strings are recommended in defining regular expressions. Raw strings are prepended with a <code>r</code> before the first quotation mark.</p>
<p>Similar as <code>grep</code>:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">re.search(<span class="string">r'Rostam'</span>, cc_list)</span><br><span class="line">re.search(<span class="string">r'Chr[a-z][a-z]'</span>, cc_list)</span><br><span class="line">re.search(<span class="string">r'[A-Za-z]&#123;6&#125;'</span>, cc_list)</span><br><span class="line">re.search(<span class="string">r'[A-Za-z]+@[a-z]+\.[a-z]+'</span>, cc_list)</span><br></pre></td></tr></table></figure></p>
<h2 id="Lazy-Evaluation"><a href="#Lazy-Evaluation" class="headerlink" title="Lazy Evaluation"></a>Lazy Evaluation</h2><p>This will have footprint in memory, generate values as needed, will not take much memory.</p>
<p>Create generator, using <code>()</code> instead of <code>[]</code>(list comprehension)<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gen_o_nums = (x <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">100</span>))</span><br></pre></td></tr></table></figure></p>
<h2 id="More-IPYTHON-features"><a href="#More-IPYTHON-features" class="headerlink" title="More IPYTHON features"></a>More IPYTHON features</h2><p>Using IPython To Run Unix Shell Commands, add <code>!</code> before command, but sometime does not need (default setting):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">In [2]: !ls -l</span><br></pre></td></tr></table></figure></p>
<p>can assign to a variable:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [6]: res = !df -h | head -n 7</span><br><span class="line"></span><br><span class="line"><span class="comment">## list format</span></span><br><span class="line">In [7]: res</span><br><span class="line">Out[7]:</span><br><span class="line">[<span class="string">'Filesystem                 Size  Used Avail Use% Mounted on'</span>,</span><br><span class="line"> <span class="string">'/dev/mapper/rhel-root      241G   73G  169G  31% /'</span>,</span><br><span class="line"> <span class="string">'devtmpfs                   3.9G     0  3.9G   0% /dev'</span>,</span><br><span class="line"> <span class="string">'tmpfs                      3.9G     0  3.9G   0% /dev/shm'</span>,</span><br><span class="line"> <span class="string">'tmpfs                      3.9G  403M  3.5G  11% /run'</span>,</span><br><span class="line"> <span class="string">'tmpfs                      3.9G     0  3.9G   0% /sys/fs/cgroup'</span>,</span><br><span class="line"> <span class="string">'/dev/vda1                 1014M  208M  807M  21% /boot'</span>]</span><br><span class="line"></span><br><span class="line">In [8]: res.grep(<span class="string">"dev"</span>)</span><br><span class="line">Out[8]:</span><br><span class="line">[<span class="string">'/dev/mapper/rhel-root      241G   73G  169G  31% /'</span>,</span><br><span class="line"> <span class="string">'devtmpfs                   3.9G     0  3.9G   0% /dev'</span>,</span><br><span class="line"> <span class="string">'tmpfs                      3.9G     0  3.9G   0% /dev/shm'</span>,</span><br><span class="line"> <span class="string">'/dev/vda1                 1014M  208M  807M  21% /boot'</span>]</span><br></pre></td></tr></table></figure></p>
<p>magic commands:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## enter bash </span></span><br><span class="line">In [13]: %%bash</span><br><span class="line"><span class="comment">## write into a file</span></span><br><span class="line">In [14]: %%writefile test.sh</span><br></pre></td></tr></table></figure></p>
<p><a href="https://www.quora.com/How-can-I-make-IPython-import-the-aliases-defined-in-my-bash-profile-upon-startup" target="_blank" rel="noopener">Make IPython import shell alias</a><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line">c = get_config()</span><br><span class="line"><span class="keyword">with</span> open(os.path.expanduser(<span class="string">'~/.bashrc'</span>)) <span class="keyword">as</span> bashrc:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> bashrc:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line.startswith(<span class="string">'alias'</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        parts = re.match(<span class="string">r'^alias (\w+)=([\'"]?)(.+)\2$'</span>, line.strip())</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> parts:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        source, _, target = parts.groups()</span><br><span class="line">        c.AliasManager.user_aliases.append((source, target))</span><br></pre></td></tr></table></figure></p>
<p>Drop this code in <code>~/.ipython/profile_default/ipython_config.py</code>, just like <code>.bashrc</code> and <code>.vimrc</code>, the configuration file for ipython.</p>
<p>How to import shell functions in <code>.bashrc</code>? Or wirte python function instead.</p>
<h1 id="Chapter-2-Automating-Text-and-Files"><a href="#Chapter-2-Automating-Text-and-Files" class="headerlink" title="Chapter 2 Automating Text and Files"></a>Chapter 2 Automating Text and Files</h1><p>In the DevOps world, you are continually parsing, searching, and changing the text in files, whether it’s searching application logs or propagating configuration files.</p>
<p>read regular file:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## don't need to close explicitly</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"/root/DS/tmp.txt"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> handler:</span><br><span class="line">  data = handler.read()</span><br><span class="line"></span><br><span class="line"><span class="comment">## one char</span></span><br><span class="line">data[<span class="number">0</span>]</span><br><span class="line"><span class="comment">## file size</span></span><br><span class="line">len(data)</span><br></pre></td></tr></table></figure></p>
<p>or use<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## this will parse lines by `\n`</span></span><br><span class="line">data = readlines()</span><br><span class="line"><span class="comment">## i-th line</span></span><br><span class="line">data[i]</span><br></pre></td></tr></table></figure></p>
<p>Different operating systems use different escaped characters to represent line-endings. Unix systems use <code>\n</code> and Windows systems use <code>\r\n</code>. Python converts these to <code>\n</code> when you open a file as text. If you are opening a binary file, such as a jpeg image, you are likely to corrupt the data by this conversion if you open it as text. You can, however, read binary files by appending a <code>b</code> to mode:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_path = <span class="string">'bookofdreamsghos00lang.pdf'</span></span><br><span class="line"><span class="keyword">with</span> open(file_path, <span class="string">'rb'</span>) <span class="keyword">as</span> open_file:</span><br><span class="line">  btext = open_file.read()</span><br></pre></td></tr></table></figure></p>
<p>write file:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">content=<span class="string">'''export a=123</span></span><br><span class="line"><span class="string">export b=456</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"/root/DS/.envrc"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> handler:</span><br><span class="line">  handler.write(content)</span><br></pre></td></tr></table></figure></p>
<p>The <code>open</code> function creates the file if it does not already exist and overwrites if it does. if want to append, use <code>a</code> mode instead of <code>w</code>. For binary file use <code>bw</code> or <code>ba</code>.</p>
<h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'xx.json'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> handler:</span><br><span class="line">  data = json.load(handler)</span><br><span class="line"></span><br><span class="line">json.load() <span class="keyword">is</span> used to load file</span><br><span class="line"><span class="comment">## Deserialize fp (a .read()-supporting text file or binary file containing a JSON document) to a Python object using this conversion table.</span></span><br><span class="line"></span><br><span class="line">json.loads() <span class="keyword">is</span> used to load other object</span><br><span class="line"><span class="comment">##Deserialize s (a str, bytes or bytearray instance containing a JSON document) to a Python object using this conversion table.</span></span><br><span class="line"></span><br><span class="line">pprint</span><br><span class="line">Pretty printing has been turned ON</span><br><span class="line"><span class="comment">## then print data is good</span></span><br><span class="line"><span class="comment">## or</span></span><br><span class="line">print(json.dumps(data, indent=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">## update</span></span><br><span class="line">data[<span class="string">"workerNodeHosts"</span>][<span class="number">0</span>][<span class="string">"name"</span>] = <span class="string">"localhost"</span></span><br><span class="line"><span class="comment">## write file</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'xx.json'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> handler:</span><br><span class="line">  json.dump(data, handler, indent=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## the same as load() and loads()</span></span><br><span class="line">json.dump() <span class="keyword">is</span> <span class="keyword">for</span> file</span><br><span class="line">json.dumps() <span class="keyword">is</span> <span class="keyword">for</span> general object</span><br></pre></td></tr></table></figure>
<p>actually you can use data pretty printer:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">pprint.pprint(data)</span><br></pre></td></tr></table></figure></p>
<h2 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h2><p>The most commonly used library for parsing YAML files in Python is <code>PyYAML</code>. It is not in the Python Standard Library, but you can install it using pip:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pip install pyyaml</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="comment">## read</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"xx.yml"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> handler: </span><br><span class="line">  data = yaml.safe_load(handler) </span><br><span class="line"></span><br><span class="line"><span class="comment">## python convert data as a dict, so you can edit it</span></span><br><span class="line"></span><br><span class="line">print(yaml.dump(data, indent=<span class="number">2</span>))</span><br><span class="line"><span class="comment">## write</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"xx.yml"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> handler:</span><br><span class="line">  yaml.dump(data, handler, indent=<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h2><p>Historically, many web systems used XML to transport data. One use is for <code>RSS</code> feeds. <code>RSS (Really Simple Syndication)</code> feeds are used to track and notify users of updates to websites. These feeds have been used to track the publication of articles from various sources. RSS uses XML formatted pages. Python offers the xml library for dealing with XML documents. It maps the XML documents hierarchical structure to a tree-like data structure.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line">tree = ET.parse(<span class="string">'/tmp/test.xml'</span>)</span><br><span class="line">root = tree.getroot()</span><br><span class="line"><span class="keyword">for</span> child <span class="keyword">in</span> root:</span><br><span class="line">  print(child.tag, child.attrib)</span><br></pre></td></tr></table></figure></p>
<h2 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h2><p>data stored as comma-separated values.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">16</span>]: <span class="keyword">import</span> csv</span><br><span class="line">In [<span class="number">17</span>]: file_path = <span class="string">'/tmp/user.csv'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">18</span>]: <span class="keyword">with</span> open(file_path, newline=<span class="string">''</span>) <span class="keyword">as</span> handler:</span><br><span class="line">    ...:     off_reader = csv.reader(handler, delimiter=<span class="string">','</span>)</span><br><span class="line">    ...:     <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    ...:         print(next(off_reader))</span><br><span class="line">    ..</span><br></pre></td></tr></table></figure></p>
<p><code>pandas</code> packages is mainstay to do data science work.<br>Pandas has many more methods for analyzing and manipulating table like data, and there are many books on its use. You should be aware that it is available if you need to do data analysis.</p>
<h2 id="Search-Text"><a href="#Search-Text" class="headerlink" title="Search Text"></a>Search Text</h2><p>One widely used format is the <code>Common Log Format (CLF)</code>. A variety of log analysis tools can understand this format:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;IP Address&gt; &lt;Client Id&gt; &lt;User Id&gt; &lt;Time&gt; &lt;Request&gt; &lt;Status&gt; &lt;Size&gt;</span><br><span class="line">127.0.0.1 - swills [13/Nov/2019:14:43:30 -0800] &quot;GET /assets/234 HTTP</span><br></pre></td></tr></table></figure></p>
<p>Just give some examples:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">line = <span class="string">'127.0.0.1 - swills [13/Nov/2019:14:43:30 -0800] "GET /assets/234 HTTP/1.0" 200 2326'</span></span><br><span class="line"><span class="comment">## use name groups</span></span><br><span class="line">r = <span class="string">r'(?P&lt;IP&gt;\d+\.\d+\.\d+\.\d+) - (?P&lt;User&gt;\w+) \[(?P&lt;Time&gt;\d\d/\w&#123;3&#125;/\d&#123;4&#125;:\d&#123;2&#125;:\d&#123;2&#125;:\d&#123;2&#125; [-+]\d&#123;4&#125;)\] (?P&lt;Request&gt;".+")'</span></span><br><span class="line">m = re.search(r, line)</span><br><span class="line"></span><br><span class="line">In [<span class="number">11</span>]: m.group(<span class="string">'IP'</span>)</span><br><span class="line">Out[<span class="number">11</span>]: <span class="string">'129.0.0.1'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: m.group(<span class="string">'Time'</span>)</span><br><span class="line">Out[<span class="number">12</span>]: <span class="string">'13/Nov/2019:14:43:30 -0800'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">13</span>]: m.group(<span class="string">'User'</span>)</span><br><span class="line">Out[<span class="number">13</span>]: <span class="string">'swills'</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: m.group(<span class="string">'Request'</span>)</span><br><span class="line">Out[<span class="number">14</span>]: <span class="string">'"GET /assets/234 HTTP/1.0"'</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Note: Python automatically allocates and frees memory.The Python garbage collector can be controlled using the <code>gc</code> package, though this is rarely needed.</p>
</blockquote>
<p>For large files. If the files contain data that can be processed one line at a time, the task is easy with Python. You can read one line at a time, process the line, and then move to the next. The lines are removed from memory automatically by Python’s garbage collector, freeing up memory.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">23</span>]: <span class="keyword">with</span> open(<span class="string">'big-data.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> source_file:</span><br><span class="line">    ...:     <span class="keyword">with</span> open(<span class="string">'big-data-corrected.txt'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> target_file:</span><br><span class="line">    ...:         <span class="keyword">for</span> line <span class="keyword">in</span> source_file:</span><br><span class="line">    ...:             target_file.write(line)</span><br></pre></td></tr></table></figure>
<h1 id="Chapter-3-Command-Line"><a href="#Chapter-3-Command-Line" class="headerlink" title="Chapter 3 Command Line"></a>Chapter 3 Command Line</h1><p>Python offers tools for interacting with systems and shells. You should become familiar with the <code>sys</code>, <code>os</code>, and <code>subprocess</code> modules, as are all essential tools.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment">## little or big endian</span></span><br><span class="line">sys.byteorder</span><br><span class="line"><span class="comment">## python object size</span></span><br><span class="line">sys.getsizeof(<span class="number">1</span>)</span><br><span class="line"><span class="comment">## platform</span></span><br><span class="line">sys.platform</span><br><span class="line"><span class="comment">## python version</span></span><br><span class="line">sys.version_info.major</span><br><span class="line">sys.version_info.minor</span><br></pre></td></tr></table></figure>
<p>The most common usage of the os module is to get settings from environment variables.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment">## pwd and cd</span></span><br><span class="line">os.getcwd()</span><br><span class="line">os.chdir(<span class="string">'/tmp'</span>)</span><br><span class="line"><span class="comment">## get and set env var</span></span><br><span class="line">os.environ.get(<span class="string">'HOME'</span>)</span><br><span class="line">os.environ[<span class="string">'HOME'</span>] = <span class="string">'/tmp'</span></span><br><span class="line"><span class="comment">## login user</span></span><br><span class="line">os.getlogin()</span><br></pre></td></tr></table></figure></p>
<p>With <code>subprocess</code> you can run your favorite shell command or other command line software and collect its output from within Python. For the majority of use-cases, you should use the <code>subprocess.run</code> function to spawn processes<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">sub = subprocess.run([<span class="string">'ls'</span>, <span class="string">'-ltr'</span>], capture_output=<span class="keyword">True</span>, universal_newlines=<span class="keyword">True</span>)</span><br><span class="line">sub.stdout</span><br><span class="line">sub.stderr</span><br><span class="line"><span class="comment">## exception will be raised when use</span></span><br><span class="line">sub = subprocess.run([<span class="string">'ls'</span>, <span class="string">'/non'</span>], capture_output=<span class="keyword">True</span>, universal_newlines=<span class="keyword">True</span>, check=<span class="keyword">True</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="Creating-Command-Line-Tools"><a href="#Creating-Command-Line-Tools" class="headerlink" title="Creating Command Line Tools"></a>Creating Command Line Tools</h2><p>Invoke python script usually by:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python xx.py</span><br></pre></td></tr></table></figure></p>
<p>or you can eliminate python by adding <code>#!/usr/bin/env python</code>(or <code>python3</code>) at first line of the script, then <code>chmod</code> the script to executable:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./xx.py</span><br></pre></td></tr></table></figure></p>
<p>The simplest and most basic way to process arguments from the command line is to use the argv attribute of the <code>sys module</code>:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Simple command line tool using sys.argv</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  <span class="comment">## sys.argv is a list</span></span><br><span class="line">  sys.argv[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="string">'--help'</span> <span class="keyword">in</span> sys.argv:</span><br><span class="line">    help_message = <span class="string">f"Usage: <span class="subst">&#123;sys.argv[<span class="number">0</span>]&#125;</span> ..."</span></span><br><span class="line">    print(help_message)</span><br><span class="line">    sys.exit()</span><br><span class="line"><span class="comment">## can get index</span></span><br><span class="line">idx = sys.argv.index(<span class="string">'--namespace'</span>)</span><br><span class="line">namespace = sys.argv[idx]</span><br></pre></td></tr></table></figure></p>
<p>This is not enough, we need argument parser! Luckily there are modules and packages designed for the creation of command line tools. These packages provide frameworks to design the user interface for your module when running in a shell. Three popular solutions <code>argparse</code>, <code>click</code>, and <code>fire</code>. All three include ways to design required arguments, optional flags, and means to display help documentation. The first, argparse, is part of the Python standard library, and the other two are third-party packages that need to be installed separately (using pip).</p>
<h3 id="argparse"><a href="#argparse" class="headerlink" title="argparse"></a>argparse</h3><p>这个有专门的tutorial，大概看了一下，it does take much work on your part but you get lots of control.</p>
<p>Automatically generates help and usage messages and issues errors when users give the program invalid arguments.<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Command line tool using argparse</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">'Process some integers.'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'integers'</span>, metavar=<span class="string">'N'</span>, type=int, nargs=<span class="string">'+'</span>,</span><br><span class="line">                    help=<span class="string">'an integer for the accumulator'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## If the name begins with a dash, it is treated as an optional, flag, argument, otherwise as a position-dependent command. </span></span><br><span class="line">parser.add_argument(<span class="string">'--sum'</span>, dest=<span class="string">'accumulate'</span>, action=<span class="string">'store_const'</span>,</span><br><span class="line">                    const=sum, default=max,</span><br><span class="line">                    help=<span class="string">'sum the integers (default: find the max)'</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line">print(args.accumulate(args.integers))</span><br></pre></td></tr></table></figure></p>
<p>You can also define sub-commands, like <code>git stash ...</code>.</p>
<h3 id="click"><a href="#click" class="headerlink" title="click"></a>click</h3><p>It uses Python <code>Function Decorators</code> to bind the command line interface directly with your functions. </p>
<p>Python decorators are a special syntax for functions <strong>take other functions as arguments</strong>. Python functions are objects, so any function can take a function as an argument. The decorator syntax provides a clean and easy way to do this.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Simple Click example</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> click</span><br><span class="line"></span><br><span class="line"><span class="meta">@click.command()</span></span><br><span class="line"><span class="meta">@click.option('--greeting', default='Hiya', help='How do you want to greet?')</span></span><br><span class="line"><span class="meta">@click.option('--name', default='Tammy', help='Who do you want to greet?')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">(greeting, name)</span>:</span></span><br><span class="line">    print(<span class="string">f"<span class="subst">&#123;greeting&#125;</span> <span class="subst">&#123;name&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    greet()</span><br></pre></td></tr></table></figure>
<p>Please refer to <a href="https://click.palletsprojects.com/en/7.x/" target="_blank" rel="noopener">click documents</a>.</p>
<h3 id="fire"><a href="#fire" class="headerlink" title="fire"></a>fire</h3><p><a href="https://github.com/google/python-fire" target="_blank" rel="noopener">fire document</a>.</p>
<p>for example:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Simple Fire example</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">greet</span><span class="params">(greeting=<span class="string">'Hiya'</span>, name=<span class="string">'Tammy'</span>)</span>:</span></span><br><span class="line">    print(<span class="string">f"<span class="subst">&#123;greeting&#125;</span> <span class="subst">&#123;name&#125;</span>"</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">goodbye</span><span class="params">(goodbye=<span class="string">'Bye'</span>, name=<span class="string">'Tammy'</span>)</span>:</span></span><br><span class="line">    print(<span class="string">f"<span class="subst">&#123;goodbye&#125;</span> <span class="subst">&#123;name&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    fire.Fire()</span><br></pre></td></tr></table></figure></p>
<p>An exciting feature of fire is the ability to enter an interactive mode easily. By using the <code>--interactive</code> flag, fire opens an IPython shell with the object and functions of your script available:<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./fire_example.py &lt;command&gt; &lt;args&gt; -- --interactive</span><br></pre></td></tr></table></figure></p>
<p>Overall, We recommend <code>click</code> for most use cases. It balances ease and control. In the case of complex interfaces where you want to separate the UI code from business logic, <code>argparse</code> is the way to go. Moreover, if you need to access code that does not have a command line interface quickly, <code>fire</code> is right for you.</p>
<h2 id="Implementing-plugins"><a href="#Implementing-plugins" class="headerlink" title="Implementing plugins"></a>Implementing plugins</h2><p>Once you’ve implemented your applications command line user interface you might want to consider a plugin system. Plugins are pieces of code supplied by the user of your program to extend functionality. </p>
<p>A key part of any plugin system is plugin discover. Your program needs to know what plugins are available to load and run. Create a file named <code>add_plugins.py</code><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">import</span> fire</span><br><span class="line"><span class="keyword">import</span> pkgutil</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_and_run_plugins</span><span class="params">(plugin_prefix)</span>:</span></span><br><span class="line">    plugins = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Discover and Load Plugins</span></span><br><span class="line">    print(<span class="string">f"Discovering plugins with prefix: <span class="subst">&#123;plugin_prefix&#125;</span>"</span>)</span><br><span class="line">    <span class="comment"># pkgutil.iter_modules returns all modules available in the current sys.path</span></span><br><span class="line">    <span class="keyword">for</span> _, name, _ <span class="keyword">in</span>  pkgutil.iter_modules():</span><br><span class="line">        <span class="comment"># Check if the module uses our plugin prefix</span></span><br><span class="line">        <span class="keyword">if</span> name.startswith(plugin_prefix):</span><br><span class="line">            <span class="comment"># Use importlib to load the module, saving it in a dict for later use.</span></span><br><span class="line">            module = importlib.import_module(name)</span><br><span class="line">            plugins[name] = module</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Run Plugins</span></span><br><span class="line">    <span class="keyword">for</span> name, module <span class="keyword">in</span> plugins.items():</span><br><span class="line">        print(<span class="string">f"Running plugin <span class="subst">&#123;name&#125;</span>"</span>)</span><br><span class="line">        <span class="comment"># Call the run method on the plugin.</span></span><br><span class="line">        module.run()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    fire.Fire()</span><br></pre></td></tr></table></figure></p>
<p>then you can wirte modules for example: <code>module1.py</code> and put it in <code>sys.path</code> directory. If you run <code>./add_plugins.py find_and_run_plugins module</code>, then it will search, load and run the <code>module1.py</code> module.</p>
<h2 id="Turbocharging-Python-with-Command-Line-Tools"><a href="#Turbocharging-Python-with-Command-Line-Tools" class="headerlink" title="Turbocharging Python with Command Line Tools"></a>Turbocharging Python with Command Line Tools</h2><p>Here are the raw ingredients that will be used to make several solutions:</p>
<ul>
<li>Click Framework</li>
<li>Python CUDA Framework</li>
<li>Numba Framework</li>
<li>Scikit-learn Machine Learning Framework</li>
</ul>
<p>These are tools to speed up the performance.</p>
<h1 id="Chapter-4-Useful-Linux-Utilities"><a href="#Chapter-4-Useful-Linux-Utilities" class="headerlink" title="Chapter 4 Useful Linux Utilities"></a>Chapter 4 Useful Linux Utilities</h1><p>This chapter will go through some common patterns in the shell and will include some useful Python commands that should enhance the ability to interact with a machine.</p>
<p>As a seasoned performance engineer once said, it depends on what is measured and how.</p>
<h2 id="disk-utility"><a href="#disk-utility" class="headerlink" title="disk utility"></a>disk utility</h2><p>If we had to work in an isolated environment with a server that doesn’t have access to the internet or that we don’t control and therefore can’t install packages, we would have to say that the <code>dd</code> tool can provide help.</p>
<p>This will get thoughput of the new device, for example, the throughput is 1.4GB/s<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/zero of=&lt;new device&gt; count=10 bs=100M</span><br><span class="line"></span><br><span class="line">10+0 records in</span><br><span class="line">10+0 records out</span><br><span class="line">10506731520 bytes (11 GB) copied, 3.12099 s, 1.4 GB/s</span><br></pre></td></tr></table></figure></p>
<p>how to get IOPS, update every 1 second:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iostat -d &lt;device&gt; 1</span><br></pre></td></tr></table></figure></p>
<p>Other common test tool is <code>fio</code>, you may need to install this package. It can help clarify the performance behavior of a device in a read-heavy or write-heavy environment (and even adjust the percentages of reads vs. writes).</p>
<h2 id="network-utility"><a href="#network-utility" class="headerlink" title="network utility"></a>network utility</h2><ul>
<li>ssh tunneling (ssh port forwarding)</li>
</ul>
<p>For example, the server hello.com can only access by ssh with port 3345 and not exposed,let’s forward hello.com:3345 to a local port in my machine:<br><a href="https://www.youtube.com/watch?v=AtuAdk4MwWw" target="_blank" rel="noopener">https://www.youtube.com/watch?v=AtuAdk4MwWw</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -f -L 12333:hello.com:3345 root@hello.com -N</span><br></pre></td></tr></table></figure></p>
<p><code>-f</code> means run in bachground<br><code>-L</code> is forwarding rule<br><code>-N</code> means don’t get into remote shell<br><a href="mailto:`root@hello.com" target="_blank" rel="noopener">`root@hello.com</a>` is the username and address of that server</p>
<p>This tech can also be used to bypass firewall for some ports. Then we can access localhost:12333 to access the server.<br>疑问：如果port已经被firewall block了，ssh是怎么连接上的呢？</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/book/" rel="tag"># book</a>
          
            <a href="/tags/python/" rel="tag"># python</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/09/27/linux-double-softlink/" rel="next" title="Double Level Softlink">
                <i class="fa fa-chevron-left"></i> Double Level Softlink
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/10/11/docker-commit/" rel="prev" title="Docker Commit">
                Docker Commit <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/cuishao.png" alt="海胆阶段">
            
              <p class="site-author-name" itemprop="name">海胆阶段</p>
              <p class="site-description motion-element" itemprop="description">骐骥一跃，不能十步；驽马十驾，功在不舍</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">165</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">29</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">93</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Install-and-Configure"><span class="nav-number">1.</span> <span class="nav-text">Install and Configure</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter-1-Introduction"><span class="nav-number">2.</span> <span class="nav-text">Chapter 1 Introduction</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Built-in-Functions"><span class="nav-number">2.1.</span> <span class="nav-text">Built-in Functions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Functions"><span class="nav-number">2.2.</span> <span class="nav-text">Functions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RE-package"><span class="nav-number">2.3.</span> <span class="nav-text">RE package</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lazy-Evaluation"><span class="nav-number">2.4.</span> <span class="nav-text">Lazy Evaluation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#More-IPYTHON-features"><span class="nav-number">2.5.</span> <span class="nav-text">More IPYTHON features</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter-2-Automating-Text-and-Files"><span class="nav-number">3.</span> <span class="nav-text">Chapter 2 Automating Text and Files</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#JSON"><span class="nav-number">3.1.</span> <span class="nav-text">JSON</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#YAML"><span class="nav-number">3.2.</span> <span class="nav-text">YAML</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#XML"><span class="nav-number">3.3.</span> <span class="nav-text">XML</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSV"><span class="nav-number">3.4.</span> <span class="nav-text">CSV</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Search-Text"><span class="nav-number">3.5.</span> <span class="nav-text">Search Text</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter-3-Command-Line"><span class="nav-number">4.</span> <span class="nav-text">Chapter 3 Command Line</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Creating-Command-Line-Tools"><span class="nav-number">4.1.</span> <span class="nav-text">Creating Command Line Tools</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#argparse"><span class="nav-number">4.1.1.</span> <span class="nav-text">argparse</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#click"><span class="nav-number">4.1.2.</span> <span class="nav-text">click</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fire"><span class="nav-number">4.1.3.</span> <span class="nav-text">fire</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Implementing-plugins"><span class="nav-number">4.2.</span> <span class="nav-text">Implementing plugins</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Turbocharging-Python-with-Command-Line-Tools"><span class="nav-number">4.3.</span> <span class="nav-text">Turbocharging Python with Command Line Tools</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter-4-Useful-Linux-Utilities"><span class="nav-number">5.</span> <span class="nav-text">Chapter 4 Useful Linux Utilities</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#disk-utility"><span class="nav-number">5.1.</span> <span class="nav-text">disk utility</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#network-utility"><span class="nav-number">5.2.</span> <span class="nav-text">network utility</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chengdong Liao</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="Symbols count total">637k</span>
  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.7.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  

  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  











  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('Copied');
          else $(this).text('Copy failed');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('Copy');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>
