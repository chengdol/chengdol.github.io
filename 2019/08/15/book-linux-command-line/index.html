<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="中文|English">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="距离第一次看这本书的第一版已经快2年了，当时还完全是个newbie. 这是看第二遍，第二版，重新整理一下笔记，巩固一下不太常用的内容。 — 2021/02/06 - 2021/03/13. Part 1 When we speak of the command line, we are really referring to the shell. The shell is a program th">
<meta name="keywords" content="book,linux">
<meta property="og:type" content="article">
<meta property="og:title" content="The Linux Command Line 2nd">
<meta property="og:url" content="http://yoursite.com/2019/08/15/book-linux-command-line/index.html">
<meta property="og:site_name" content="海胆阶段&#39;s Blog">
<meta property="og:description" content="距离第一次看这本书的第一版已经快2年了，当时还完全是个newbie. 这是看第二遍，第二版，重新整理一下笔记，巩固一下不太常用的内容。 — 2021/02/06 - 2021/03/13. Part 1 When we speak of the command line, we are really referring to the shell. The shell is a program th">
<meta property="og:locale" content="中文|English">
<meta property="og:updated_time" content="2022-05-04T04:02:21.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="The Linux Command Line 2nd">
<meta name="twitter:description" content="距离第一次看这本书的第一版已经快2年了，当时还完全是个newbie. 这是看第二遍，第二版，重新整理一下笔记，巩固一下不太常用的内容。 — 2021/02/06 - 2021/03/13. Part 1 When we speak of the command line, we are really referring to the shell. The shell is a program th">






  <link rel="canonical" href="http://yoursite.com/2019/08/15/book-linux-command-line/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>The Linux Command Line 2nd | 海胆阶段's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="中文|English">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">海胆阶段's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags<span class="badge">159</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories<span class="badge">48</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives<span class="badge">292</span></a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>Search</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/08/15/book-linux-command-line/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="海胆阶段">
      <meta itemprop="description" content="骐骥一跃，不能十步；驽马十驾，功在不舍">
      <meta itemprop="image" content="/images/cuishao.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="海胆阶段's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">The Linux Command Line 2nd

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-08-15 16:49:39" itemprop="dateCreated datePublished" datetime="2019-08-15T16:49:39-07:00">2019-08-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2022-05-03 21:02:21" itemprop="dateModified" datetime="2022-05-03T21:02:21-07:00">2022-05-03</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Book/" itemprop="url" rel="index"><span itemprop="name">Book</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>距离第一次看这本书的第一版已经快2年了，当时还完全是个newbie. 这是看第二遍，第二版，重新整理一下笔记，巩固一下不太常用的内容。
— 2021/02/06 - 2021/03/13.</p>
<h1>Part 1</h1>
<p>When we speak of the command line, we are really referring to the shell. The shell is a program that takes keyboard commands and passes them to the operating system to carry out.</p>
<p>If the last character of the prompt is a <code>hash mark(#)</code> rather than a <code>$</code>, the terminal session has superuser privileges.</p>
<p>Terminal emulator，想想为啥叫emulator, 因为它是从GUI中提供的，并不是系统boot后直接进入terminal的形式。</p>
<p>Unix-like systems such as Linux always have a single file system tree, regardless of how many drives or storage devices are attached to the computer. Starts from <code>/</code>.</p>
<p>Linux has no concept of a <code>file extension</code> like some other operating systems. Although Unix-like operating systems don’t use file extensions to determine the contents/purpose of files, many application programs do.</p>
<p>Some options and arguments unknown to me or not common:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd to home of vagrant user</span></span><br><span class="line"><span class="built_in">cd</span> ~vagrant</span><br><span class="line"><span class="comment"># list multiple directories</span></span><br><span class="line">ls ~ /usr /opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># A: list all but . and ..</span></span><br><span class="line"><span class="comment"># F: append / for directories</span></span><br><span class="line">ls -AF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3: number of existing hard link to this file data part</span></span><br><span class="line">drwxr-xr-x 3 root root  24 Jun  6  2020 mnt</span><br><span class="line"></span><br><span class="line"><span class="comment"># in less page hit 'h': display help screen</span></span><br><span class="line">less file</span><br><span class="line"></span><br><span class="line"><span class="comment"># re-initialize the terminal, deeper than clear</span></span><br><span class="line"><span class="comment"># 很少用到</span></span><br><span class="line">reset</span><br><span class="line"></span><br><span class="line"><span class="comment"># -u: When copying files from one directory to another</span></span><br><span class="line"><span class="comment"># only copy files that either don’t exist or are newer</span></span><br><span class="line"><span class="comment"># than the existing corresponding files in the destination directory. </span></span><br><span class="line">cp -u|--update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Normally, copies take on the default attributes of the user performing the copy.</span></span><br><span class="line"><span class="comment"># a: preserve the original permission and user/group</span></span><br><span class="line"><span class="comment"># for example, root user cp oridinary user file</span></span><br><span class="line">cp -a</span><br></pre></td></tr></table></figure>
<p>Remember that a file will always have at least one hard link because the file’s name is created by a link. When we create hard links, we are actually creating additional name parts that all refer to the same data part.</p>
<p>Directory 是不能有hard link的，一个文件夹的hardlink 部分数字一般是2+n, 2代表文件夹内部<code>.</code>, <code>..</code>, n 代表subdirectories数量。</p>
<p>The <code>type</code> command is a shell builtin that displays the kind of command the shell will execute, command can be categorized as:</p>
<ul>
<li>executable binary</li>
<li>script</li>
<li>function</li>
<li>alias</li>
</ul>
<p><code>which</code> is for locating executables only.
<code>apropos</code> is the same as <code>man -k</code>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apropos partition</span><br><span class="line">man -k partition</span><br></pre></td></tr></table></figure>
<p>Modern version of redirection:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &amp;&gt; is equal to 2&gt;&amp;1</span></span><br><span class="line">ls -l /bin/usr &amp;&gt; ls-output.txt</span><br><span class="line"><span class="comment"># append</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"123"</span> &amp;&gt;&gt; ls-output.txt</span><br></pre></td></tr></table></figure>
<p>Interesting accident below, The lesson here is that the redirection operator silently creates or overwrites files, so you need to treat it with a lot of respect.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/bin</span><br><span class="line"><span class="comment"># overwrite less program under /usr/bin</span></span><br><span class="line"><span class="comment"># instead use ls | less</span></span><br><span class="line">ls &gt; less</span><br></pre></td></tr></table></figure>
<p>Path expansion, 我有blog专门记录了shell globings, pattern match, expansion:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># list hidden files without . and ..</span></span><br><span class="line"><span class="built_in">echo</span> .[!.]*</span><br><span class="line"></span><br><span class="line"><span class="comment"># arithmetic</span></span><br><span class="line"><span class="comment"># 注意区别(( ))是针对integer的compound command, used in condition such as if, while, for, etc.</span></span><br><span class="line"><span class="built_in">echo</span> $((3 + 4))</span><br><span class="line"><span class="comment"># can use single parentheses inside without $ prefix</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$(((5**2)</span> * 3))"</span></span><br></pre></td></tr></table></figure>
<p>Remember, parameter expansion “$USER”, arithmetic expansion, and command substitution still take place within double quotes. If we need to suppress all expansions, we use single quotes.</p>
<p>Command history quick rerun:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># execute last command</span></span><br><span class="line">!!</span><br><span class="line"><span class="comment"># execute command at 123 line in hsitory</span></span><br><span class="line">!123</span><br><span class="line"></span><br><span class="line"><span class="comment"># be cautious</span></span><br><span class="line"><span class="comment"># last command starts with "string"</span></span><br><span class="line">!string</span><br><span class="line"><span class="comment"># last command contains "string"</span></span><br><span class="line">!?string</span><br></pre></td></tr></table></figure>
<p>Mentioned a new command <code>script</code>, used to record the terminal typing as a hardcopy into a file, for example for students learning. The history is controlled by env vars:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ignore duplicates command</span></span><br><span class="line"><span class="built_in">export</span> HISTCONTROL=ignoredups</span><br><span class="line"><span class="built_in">export</span> HISTSIZE=1000</span><br></pre></td></tr></table></figure>
<p>Load average in <code>top</code> command: refers to the number of processes that are waiting to run; that is, the number of processes that are in a runnable state and are sharing the CPU. Three values are shown, each for a different period of time. The first is the average for the last 60 seconds, the next the previous 5 minutes, and finally the previous 15 minutes. Values less than 1.0 indicate that the machine is not busy (还和有多少cores有关，多核则可以大于1).</p>
<p>Other commands for <code>top</code> useful are <code>?/h</code> for help, <code>f</code> for column and sort selection, <code>m</code> check memory utilization, sorted by memory can type <code>shift + m</code>.</p>
<p>About signal (这部分解释得比较好):</p>
<ul>
<li>HUP: also used by many daemon programs to cause a <code>reinitialization</code>. This means that when a daemon is sent this signal, it will reload its configuration file. The Apache web server is an example of a daemon that uses the HUP signal in this way.</li>
<li>INT: Interrupt. This performs the same function as <code>ctrl-c</code> sent from the terminal. It will usually terminate a program.</li>
<li>TERM: Terminate. This is the default signal sent by the kill command. If a program is still “alive” enough to receive signals, it will terminate.</li>
<li>STOP: Stop. This signal causes a process to pause without terminating. Like the KILL signal, it is not sent to the target process, and thus it cannot be ignored.</li>
<li>TSTP: Terminal stop. This is the signal sent by the terminal when <code>ctrl-z</code> is pressed. Unlike the STOP signal, the TSTP signal is received by the program, but the program may choose to ignore it.</li>
<li>CONT: Continue. This will restore a process after a STOP or TSTP signal. This signal is sent by the bg and fg commands. For example, use <code>ctrl-z</code> with a fg and then run bg to make it run in background.</li>
</ul>
<h1>Part 2</h1>
<p>The <code>set</code> command will show both the shell and environment variables as well as any defined shell functions, while <code>printenv</code> will display only the environment variables.</p>
<p>Environment variables:
<code>PS1</code>: Stands for <code>prompt string 1</code>. This defines the contents of the shell prompt. Also prompt can be customized by shell function and scripts. 还有<code>PS2</code>, <code>PS3</code>, etc. see this <a href="https://www.thegeekstuff.com/2008/09/bash-shell-take-control-of-ps1-ps2-ps3-ps4-and-prompt_command/" target="_blank" rel="noopener">article</a>.</p>
<h1>Part 3</h1>
<p>High- and Low-Level Package Tools</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Distributions              | Low-level tools       |  High-level tools</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Debian-style               | dpkg                  |  apt-get, apt, aptitude</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Fedora,                    | rpm                   |  yum, dnf</span><br><span class="line">Red Hat Enterprise Linux,  |                       |</span><br><span class="line">CentOS                     |                       |</span><br></pre></td></tr></table></figure>
<p>Low-level tools that handle tasks such as installing and removing package files.
High-level tools that perform metadata searching and dependency resolution.</p>
<p>主要了解安装，更新，删除，查找这几个操作即可，low/high level都有相关的选项.</p>
<p>Linux storage device names convention:
<code>/dev/fd*</code> Floppy disk drives
<code>/dev/hd*</code> IDE (PATA) disks on older systems
<code>/dev/lp*</code> printer
<code>/dev/sd*</code> SCSI disks. On modern Linux systems, the kernel treats all disk-like device as SCSI disks
<code>/dev/sr*</code> Optical drives (CD/DVD readers and burners)</p>
<p><code>/var/log/messages</code> vs <code>/var/log/syslog</code>, <code>/var/log/messages</code> is the syslog on non-Debian/non-Ubuntu systems such as RHEL or CentOS systems usually. <code>/var/log/messages</code> instead aims at storing valuable, non-debug and non-critical messages. This log should be considered the “general system activity” log.
<code>/var/log/syslog</code> in turn logs everything, except auth related messages.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a great way to watch what the system is doing in near real-time.</span></span><br><span class="line">tail -f /var/<span class="built_in">log</span>/messages</span><br></pre></td></tr></table></figure>
<p>The last digit in <code>/etc/fstab</code> file is used to specify integrity checking privilege when system boots by <code>fsck</code> (file system check), <code>0</code> means not routinely checked:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/sdb /data xfs defaults 0 0</span><br></pre></td></tr></table></figure>
<p><code>fsck</code> can also repair corrupt file systems with varying degrees of success, depending on the amount of damage. On Unix-like file systems, recovered portions of files are placed in the <code>lost+found</code> directory, located in the root of each file system.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># unmount /dev/sdb1 first</span></span><br><span class="line">sudo fsck /dev/sdb1</span><br></pre></td></tr></table></figure>
<p><code>dd</code> (data definition) can be used to copy block of data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># backup sdb to sdc</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/sdb of=/dev/sdc</span><br><span class="line"><span class="comment"># backup to ordinary file</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/sdb of=/tmp/sdb.bk</span><br></pre></td></tr></table></figure>
<p>When it comes to networking, there is probably nothing that cannot be done with Linux. Linux is used to build all sorts of networking systems and appliances, including firewalls, routers, name servers, network-attached storage (NAS) boxes, and on and on.</p>
<p>The <code>locate</code> database is created by another program named <code>updatedb</code>(you can run it manually or by system cronjob).
<code>find</code> command can have logic operators:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -and/-a</span></span><br><span class="line"><span class="comment"># -or/-o</span></span><br><span class="line"><span class="comment"># -not/!</span></span><br><span class="line"><span class="comment"># escape () as it has special meaning to shell</span></span><br><span class="line"><span class="comment"># object can only be a file or directory, so use -or</span></span><br><span class="line">find ~ \( -<span class="built_in">type</span> f -not -perm 0600 \) -or \( -<span class="built_in">type</span> d -not -perm 0700 \)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -print, always test first</span></span><br><span class="line">find ~ -<span class="built_in">type</span> f -name <span class="string">'*.bak'</span>[-<span class="built_in">print</span>]</span><br><span class="line"><span class="comment"># the same as</span></span><br><span class="line">find ~ -<span class="built_in">type</span> f -and -name <span class="string">'*.bak'</span> -and -<span class="built_in">print</span></span><br><span class="line"><span class="comment"># order matters!!! just like if condition and group, from left to right, short execution</span></span><br><span class="line">find ~ -<span class="built_in">print</span> -and -<span class="built_in">type</span> f -and -name <span class="string">'*.bak'</span></span><br><span class="line"><span class="comment"># -delete action</span></span><br><span class="line">find ~ -<span class="built_in">type</span> f -name <span class="string">'*.bak'</span> -delete</span><br><span class="line"></span><br><span class="line"><span class="comment"># Here, command is the name of a command, &#123;&#125; is a symbolic </span></span><br><span class="line"><span class="comment"># representation of the current pathname, and the semicolon </span></span><br><span class="line"><span class="comment"># is a required delimiter indicating the end of the command</span></span><br><span class="line"><span class="comment"># &#123;&#125; and ; need to quote as special meaning to shell</span></span><br><span class="line">find ~ -<span class="built_in">type</span> f -name <span class="string">'foo*'</span> -<span class="built_in">exec</span> ls -l <span class="string">'&#123;&#125;'</span> <span class="string">';'</span></span><br><span class="line"><span class="comment"># -ok: interactive with user</span></span><br><span class="line">find ~ -<span class="built_in">type</span> f -name <span class="string">'foo*'</span> -ok ls -l <span class="string">'&#123;&#125;'</span> <span class="string">';'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># more powerful and flexible</span></span><br><span class="line">find /tmp -mindepth 1 -maxdepth 1 -<span class="built_in">type</span> d -mmin +50 -<span class="built_in">exec</span> ls -d &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<p>It is really useful to do range search with timestamp: <a href="https://unix.stackexchange.com/questions/558124/understanding-find-with-atime-ctime-and-mtime" target="_blank" rel="noopener">atime, ctime, and mtime</a>.</p>
<p><code>xargs</code> is more efficient then regular <code>-exec {} ;</code> because it executes in one time (when setting properly), 关于这2个效率的比较: <a href="https://www.everythingcli.org/find-exec-vs-find-xargs/" target="_blank" rel="noopener">FIND -EXEC VS. FIND | XARGS</a>. 不同options是不同的效率！！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -r: when no input for xargs, don't run it</span></span><br><span class="line"><span class="comment"># 如果不用-r, 则xargs总会执行，输出不符合的结果</span></span><br><span class="line">find ~ -<span class="built_in">type</span> f -name <span class="string">'foo*'</span> -<span class="built_in">print</span> | xargs -r ls -l</span><br><span class="line"><span class="comment"># same as -exec with +</span></span><br><span class="line">find ~ -<span class="built_in">type</span> f -name <span class="string">'foo*'</span> -<span class="built_in">exec</span> ls -l <span class="string">'&#123;&#125;'</span> <span class="string">'+'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># practices</span></span><br><span class="line">find ~ \( -<span class="built_in">type</span> f -not -perm 0600 -<span class="built_in">exec</span> chmod 0600 <span class="string">'&#123;&#125;'</span> <span class="string">';'</span> \) -or \( -<span class="built_in">type</span> d -not -perm 0700 -<span class="built_in">exec</span> chmod 0700 <span class="string">'&#123;&#125;'</span> <span class="string">';'</span> \)</span><br><span class="line"><span class="comment"># with tar</span></span><br><span class="line"><span class="comment"># r: append mode to tar</span></span><br><span class="line">find ~ -name <span class="string">'file-A'</span> -<span class="built_in">exec</span> tar rf old.tar <span class="string">'&#123;&#125;'</span> <span class="string">'+'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -: stdin or stdout as needed</span></span><br><span class="line"><span class="comment"># --files-from=- 表示从upper pipeline得到文件列表</span></span><br><span class="line"><span class="comment"># cf - 表示tar的东西又输出到下一个pipeline了</span></span><br><span class="line">find playground -name <span class="string">'file-A'</span> | tar cf - --files-from=- | gzip &gt; playground.tgz</span><br><span class="line"><span class="comment"># --files-from=- abbr is equal to -T -</span></span><br><span class="line">find playground -name <span class="string">'file-A'</span> | tar cf target.tar -T -</span><br><span class="line"></span><br><span class="line"><span class="comment"># tar and transfer remote dir to local and untar</span></span><br><span class="line">ssh remote-sys <span class="string">'tar cf - Documents'</span> | tar xf -</span><br></pre></td></tr></table></figure>
<p>If the filename <code>-</code> is specified, it is taken to mean standard input or output, as needed. (By the way, this convention of using <code>-</code> to represent standard input/output is used by a number of other programs, too).</p>
<p>下面介绍一些text processing commands，其实就是git 使用的部分功能.
commonly use and known: <code>cat</code>, <code>sort</code>, <code>uniq</code>, <code>cut</code>, <code>paste</code>, <code>join</code>, <code>comm</code>, <code>diff</code>, <code>patch</code>, <code>tr</code>, <code>sed</code>, <code>aspell</code>.</p>
<p><code>sort</code>: Many uses of sort involve the processing of tabular data</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --key/-k 1,1: starts from field 1 and end at field 1</span></span><br><span class="line"><span class="comment"># -key=2n: field 2 sort as numeric</span></span><br><span class="line">sort --key=1,1 --key=2n distros.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># sort on specific part of a field</span></span><br><span class="line"><span class="comment"># Fedora    10   11/25/2008</span></span><br><span class="line"><span class="comment"># Ubuntu    8.10   10/30/2008</span></span><br><span class="line">sort -k 3.7nbr -k 3.1nbr -k 3.4nbr distros.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># sort on shell field</span></span><br><span class="line">sort -t <span class="string">':'</span> -k 7 /etc/passwd | head</span><br></pre></td></tr></table></figure>
<p><code>cut</code>: cut is best used to extract text from files that are produced by other programs, rather than text directly typed by humans.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Fedora    10   11/25/2008</span></span><br><span class="line"><span class="comment"># Ubuntu    8.10   10/30/2008</span></span><br><span class="line"><span class="comment"># extrace year number</span></span><br><span class="line"><span class="comment"># -c: character range</span></span><br><span class="line"><span class="comment"># -f: field index, start from 1</span></span><br><span class="line">cut -f 3 file | cut -c 7-10</span><br><span class="line"><span class="comment"># can convert tab to spaces</span></span><br><span class="line"><span class="comment"># tab 是会对齐field的</span></span><br><span class="line">expand file | cut -c 23-</span><br></pre></td></tr></table></figure>
<p><code>paste</code>: it adds one or more columns of text to a file in argument order</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># assume file1 file2 file3 are columned format</span></span><br><span class="line">paste file1 file2 file3</span><br></pre></td></tr></table></figure>
<p>The <code>join</code> program it joins data from multiple files based on a <code>shared</code> key field. The same as DB join operation:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># assume file1 and file2 has shared field</span></span><br><span class="line">join file1 file2</span><br></pre></td></tr></table></figure>
<p><code>comm</code>: Compare Two Sorted Files Line by Line
<code>diff</code>: Compare Files Line by Line</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># column 1 is in file1</span></span><br><span class="line"><span class="comment"># column 2 is in file2</span></span><br><span class="line"><span class="comment"># column 3 is in both file1 and file2</span></span><br><span class="line"><span class="comment"># -n (-12): remove 1 and 2 column in output</span></span><br><span class="line">comm -12 file1.txt file2.txt</span><br></pre></td></tr></table></figure>
<p><code>patch</code>: Apply a diff to an Original, It accepts output from <code>diff</code> and is generally used to convert older version files into newer versions. git其实push的也是diff的部分，然后patch 到target branch中.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># run in the same dir level</span></span><br><span class="line">diff -Naur old_file new_file &gt; diff_file</span><br><span class="line"><span class="comment"># diff_file has enough information for patch</span></span><br><span class="line">patch &lt; diff_file</span><br></pre></td></tr></table></figure>
<p>where old_file and new_file are either single file or directory containing files. The <code>r</code> option supports recursion of a directory tree.</p>
<p><code>tr</code>: think of this as a sort of character-based search-and-replace operation.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"lowercase letters"</span> | tr a-z A-Z</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"lowercase letters"</span> | tr [:lower:] A-Z</span><br><span class="line"><span class="comment"># delete</span></span><br><span class="line">tr -d <span class="string">'\r'</span> &lt;dos_file&gt; unix_file</span><br><span class="line"><span class="comment"># squeeze</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"aaabbbccc"</span> | tr -s ab</span><br></pre></td></tr></table></figure>
<p><code>nl</code>: number Lines, add header, body, footer
<code>fold</code>: wrap each line to a specified length</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -w: width 50 character</span></span><br><span class="line"><span class="comment"># -s: bread at speace not in the middle of word</span></span><br><span class="line">fold -w 50 -s test.file</span><br></pre></td></tr></table></figure>
<p><code>fmt</code>: simple text formetter, it fills and joins lines in text while preserving blank lines and indentation.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -w: width 50 characters</span></span><br><span class="line"><span class="comment"># -c: operate in crown margin mode, better format than fold</span></span><br><span class="line">fmt -cw 50 test.file</span><br></pre></td></tr></table></figure>
<p><code>printf</code>: not used for pipelines, used mostly in scripts where it is employed to format tabular data, similar to C printf:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> <span class="string">"I formatted '%s' as a string.\n"</span> foo</span><br><span class="line"><span class="comment"># the same placeholder as C program</span></span><br><span class="line"><span class="comment"># %[flags][width][.precision]placeholder</span></span><br><span class="line"><span class="built_in">printf</span> <span class="string">"%d, %f, %o, %s, %x, %X\n"</span> 380 380 380 380 380 380</span><br></pre></td></tr></table></figure>
<p><code>make</code> command to compile C/C++ program.
Some compilers translate high level instructions into assembly language and then use an assembler to perform the final stage of translation into machine language. A process often used in conjunction with compiling is called linking. A program called a linker is used to form the connections between the output of the compiler and the libraries that the compiled program requires. The final result of this process is the executable program file, ready for use.</p>
<p>Shell scripts that do not require compiling. They are executed directly. These are written in what are known as scripting or interpreted languages. These languages have grown in popularity in recent years and include Perl, Python, PHP, Ruby, and many others.</p>
<p>we need <code>Makefile</code> (usually generated by configure script) to instruct <code>make</code> command to compile source code:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># usually this file is to collect system configuration and check</span></span><br><span class="line"><span class="comment"># required libraries</span></span><br><span class="line">./configure</span><br><span class="line"><span class="comment"># compile and build app</span></span><br><span class="line"><span class="comment"># will choose Makefile in the same directory automatically</span></span><br><span class="line">make</span><br><span class="line"><span class="comment"># install app</span></span><br><span class="line"><span class="comment"># install is also a build target from running make command</span></span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p><code>install</code> will install the final product in a system directory for use. Usually, this directory is <code>/usr/local/bin</code>, the traditional location for locally built software. However, this directory is not normally writable by ordinary users, so we must become the superuser to perform the installation.</p>
<h1>Part 4</h1>
<p>Part 4 primarily talks about scripting, I place the notes in shell and scripting blogs.</p>
<p>Positional arguments, <code>$0</code> will always contain the first item appearing on the command line(exactly what it is). When parameters size is large, use <code>shift</code> to access:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">count=1</span><br><span class="line"><span class="comment"># $2 keep moving to $1</span></span><br><span class="line"><span class="keyword">while</span> [[ <span class="variable">$#</span> -gt 0 ]]; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Argument <span class="variable">$count</span> = <span class="variable">$1</span>"</span></span><br><span class="line">  count=$((count + 1))</span><br><span class="line">  <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>Just as positional parameters are used to pass arguments to shell scripts, they can also be used to pass arguments to shell functions.</p>
<p>Here document(<code>&lt;&lt;[-]</code>) and here string(<code>&lt;&lt;&lt;</code>), <code>&lt;&lt;-</code> is related to stripe leading tab, depends on your use case (usually <code>&lt;&lt;</code> is fine).</p>
<p>If the optional <code>in</code> words portion of the <code>for</code> command is omitted, for defaults to processing the positional parameters:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># set positional parameters</span></span><br><span class="line"><span class="built_in">set</span> a b c</span><br><span class="line"><span class="comment"># without in keywork, for loops the positional parameters</span></span><br><span class="line"><span class="keyword">for</span> i; <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"<span class="variable">$i</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>Modern for loop mimics C program:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># i is treated as integer, no need $i prefix in (( ))</span></span><br><span class="line"><span class="keyword">for</span> (( i=0; i&lt;5; i=i+1 )); <span class="keyword">do</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>Arithmetic evaluation:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># the same as (( )) for integer compution</span></span><br><span class="line"><span class="built_in">echo</span> $(( a + 2 ))</span><br><span class="line"><span class="built_in">echo</span> $(( 5 % 2 ))</span><br><span class="line"><span class="comment"># number bases, output is converted to 10 based value</span></span><br><span class="line"><span class="comment"># $1 is a 16 based value</span></span><br><span class="line"><span class="built_in">echo</span> $((0x<span class="variable">$1</span>))</span><br><span class="line"><span class="built_in">echo</span> $((0xff))</span><br><span class="line"><span class="comment"># 2#: 2 based</span></span><br><span class="line"><span class="built_in">echo</span> $((2<span class="comment">#11111111))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># can use C style shortcut, also used in for loop (( ))</span></span><br><span class="line"><span class="built_in">declare</span> -i a=0</span><br><span class="line">$((a+=1))</span><br><span class="line">$((a-=1))</span><br><span class="line">$((a/=1))</span><br><span class="line">$((a*=1))</span><br><span class="line">$((a++))</span><br><span class="line">$((a--))</span><br><span class="line">$((++a))</span><br><span class="line">$((--a))</span><br><span class="line"></span><br><span class="line"><span class="comment"># bit operations are the same as C</span></span><br><span class="line"><span class="keyword">for</span> ((i=0;i&lt;8;++i)); <span class="keyword">do</span> <span class="built_in">echo</span> $((1&lt;&lt;i)); <span class="keyword">done</span></span><br><span class="line"><span class="comment"># logic operation: &lt; &gt; &lt;= &gt;= == != &amp;&amp; || !</span></span><br><span class="line"><span class="built_in">echo</span> $((a&lt;1?++a:--a))</span><br></pre></td></tr></table></figure>
<p>类似C中的用法，同时做赋值和判断:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">foo=</span><br><span class="line"><span class="comment"># foo is assigned 5 and valued as true</span></span><br><span class="line"><span class="comment"># notice that here = is not ==, although in [ ], = is the same as ==</span></span><br><span class="line"><span class="keyword">if</span> (( foo = 5 )); <span class="keyword">then</span> <span class="built_in">echo</span> <span class="string">"It is true."</span>; <span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>The <code>bc</code> program reads a file written in its own C-like language and executes it. A <code>bc</code> script may be a separate file, or it may be read from standard input.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># start and quiet bc, use stdin to input</span></span><br><span class="line">bc -q</span><br><span class="line"><span class="comment"># use here string</span></span><br><span class="line">bc &lt;&lt;&lt; <span class="string">"2+2"</span></span><br></pre></td></tr></table></figure>
<p>Group command does not create subshell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># note the space after &#123; and before &#125;</span></span><br><span class="line"><span class="comment"># each cmd must has ;</span></span><br><span class="line">&#123; cmd1; cmd2; [cmd3; ...] &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123; &#125; returns the total output</span></span><br><span class="line">&#123; ls -l; <span class="built_in">echo</span> <span class="string">"Listing of foo.txt"</span>; cat foo.txt; &#125; &gt; output.txt</span><br></pre></td></tr></table></figure>
<p>Therefore, in most cases, unless a script requires a subshell, group commands are preferable to sub­ shells. Group commands are both faster and require less memory.</p>
<p>Process substitution, it feeds the output of a process (or processes) into the stdin of another process.
这里的例子主要是和read 结合使用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rediect output from process substitution to read</span></span><br><span class="line"><span class="built_in">read</span> &lt; &lt;(<span class="built_in">echo</span> <span class="string">"foo"</span>)</span><br><span class="line"><span class="comment"># or using here string</span></span><br><span class="line"><span class="built_in">read</span> &lt;&lt;&lt; <span class="string">"foo"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$REPLY</span></span><br></pre></td></tr></table></figure>
<p>Process substitution allows us to treat the output of a subshell as an ordinary file for purposes of redirection. 可以看做一个文件.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># output is /dev/fd/63</span></span><br><span class="line"><span class="built_in">echo</span> &lt;(<span class="built_in">echo</span> <span class="string">"foo"</span>)</span><br></pre></td></tr></table></figure>
<p>Process substitution is often used with loops containing <code>read</code>.</p>
<p>Other example of process substitution:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep word /usr/share/dict/linux.words | wc</span><br><span class="line"><span class="comment"># can be modified as</span></span><br><span class="line">wc &lt;(grep word /usr/share/dict/linux.words)</span><br></pre></td></tr></table></figure>
<p>In most Unix­like systems, it is possible to create a special type of file called a <code>named pipe</code>. Named pipes are used to create a connection <code>between two processes</code> and can be used just like other types of files. Named pipes behave like files but actually form first­in first­out (FIFO) buffers.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># type is p</span></span><br><span class="line"><span class="comment"># prw-r--r--. 1 root root 0 Mar 13 23:11 pipe1</span></span><br><span class="line">mkfifo pipe1</span><br><span class="line"></span><br><span class="line"><span class="comment"># in terminal 1</span></span><br><span class="line">ls -l &gt; pipe1</span><br><span class="line"></span><br><span class="line"><span class="comment"># in terminal 2</span></span><br><span class="line">cat &lt; pipe1</span><br></pre></td></tr></table></figure>
<p>The input will block if no receiving part.</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/book/" rel="tag"># book</a>
          
            <a href="/tags/linux/" rel="tag"># linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/08/13/linux-signal-trap/" rel="next" title="Linux Signals and Trap">
                <i class="fa fa-chevron-left"></i> Linux Signals and Trap
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/08/19/k8s-no-route-to-host/" rel="prev" title="K8s No Route to Host">
                K8s No Route to Host <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/cuishao.png" alt="海胆阶段">
            
              <p class="site-author-name" itemprop="name">海胆阶段</p>
              <p class="site-description motion-element" itemprop="description">骐骥一跃，不能十步；驽马十驾，功在不舍</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">292</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">48</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">159</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">1.</span> <span class="nav-text">Part 1</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">2.</span> <span class="nav-text">Part 2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">3.</span> <span class="nav-text">Part 3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#undefined"><span class="nav-number">4.</span> <span class="nav-text">Part 4</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chengdong Liao</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v6.7.0</div>





  <script src="https://unpkg.com/mermaid@7.1.2/dist/mermaid.min.js"></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize("");
    }
  </script>

        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  

  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  











  

  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  <script>
    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap');
      $(e).after($wrap);
      $wrap.append($('<button>').addClass('copy-btn').append('Copy').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text();
        }).toArray().join('\n');
        var ta = document.createElement('textarea');
        var range = document.createRange(); //For Chrome
        var sel = window.getSelection(); //For Chrome
        var yPosition = window.pageYOffset || document.documentElement.scrollTop;
        ta.style.top = yPosition + 'px'; //Prevent page scroll
        ta.style.position = 'absolute';
        ta.style.opacity = '0';
        ta.value = code;
        ta.textContent = code; //For FireFox
        ta.contentEditable = true;
        ta.readOnly = false;
        document.body.appendChild(ta);
        range.selectNode(ta);
        sel.removeAllRanges();
        sel.addRange(range);
        ta.setSelectionRange(0, code.length);
        var result = document.execCommand('copy');
        
          if (result) $(this).text('Copied');
          else $(this).text('Copy failed');
        
        ta.blur(); //For iOS
        $(this).blur();
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn');
        setTimeout(function () {
          $b.text('Copy');
        }, 300);
      }).append(e);
    })
  </script>


  

</body>
</html>
